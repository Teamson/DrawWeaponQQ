!function(){"use strict";class e{static calcDistance(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}static getDirectionAToB(e,t,a=!0){let i=e.transform.position.clone(),s=t.transform.position.clone(),n=new Laya.Vector3(0,0,0);return Laya.Vector3.subtract(s,i,n),a&&Laya.Vector3.normalize(n,n),n}static fixPosY(e,t=1334){return e*Laya.stage.displayHeight/t}static findNodeByName(e,t){let a=null,i=e=>{for(let s=0;s<e.numChildren;s++){if(e.getChildAt(s).name==t)return void(a=e.getChildAt(s));i(e.getChildAt(s))}};return i(e),a}static TmoveTo(e,t,a,i,s){let n=new Laya.Tween;var r=e.transform.position;n.to(e.transform.position,{x:a.x,y:a.y,z:a.z,update:new Laya.Handler(this,()=>{e.transform.position=r})},t,s||Laya.Ease.cubicOut,Laya.Handler.create(this,()=>{i&&i()}))}static RotateTo(e,t,a,i){var s=e.transform.localRotationEuler;Laya.Tween.to(e.transform.localRotationEuler,{x:a.x,y:a.y,z:a.z,update:new Laya.Handler(this,function(){e&&(e.transform.localRotationEuler=s)})},t,Laya.Ease.cubicOut,Laya.Handler.create(this,function(){i&&i()}))}static tMove2D(e,t,a,i,s){Laya.Tween.to(e,{x:t,y:a},i,null,new Laya.Handler(this,()=>{s&&s()}))}static updateNumber(e,t,a,i=!0,s,n){let r=e*t,o=Math.floor((r-e)/60);o=o<=0?1:o;let h=()=>{s?((e+=o)>=r&&(e=r,n&&n(),Laya.timer.clear(this,h)),i?a.text=e.toString():a.value=e.toString()):((r-=o)<=e&&(r=e,n&&n(),Laya.timer.clear(this,h)),i?a.text=r.toString():a.value=r.toString())};Laya.timer.frameLoop(1,this,h)}static loadJson(e,t){Laya.loader.load(e,Laya.Handler.create(this,t),null,Laya.Loader.JSON)}static objectShake(e,t=1,a=.7){var i=t,s=1,n=e.transform.localPosition.clone();Laya.timer.frameLoop(1,this,function updateShake(){if(i>0){var t=new Laya.Vector3;Laya.Vector3.scale((r=Math.random()>.5?Math.random():-Math.random(),o=Math.random()>.5?Math.random():-Math.random(),new Laya.Vector3(r,o,0)),a,t),Laya.Vector3.add(n,t,t),e.transform.localPosition=t,i-=.02*s}else i=0,e.transform.localPosition=n,Laya.timer.clear(this,updateShake);var r,o})}static getRandomItemInArr(e){return e[Math.floor(Math.random()*e.length)]}static shuffleArr(e){let t=e.length;for(;t;){let a=Math.floor(Math.random()*t--);[e[a],e[t]]=[e[t],e[a]]}return e}static GetRandom(e,t,a=!0){let i=t-e,s=Math.random()*i;return s+=e,a?Math.floor(s):s}static coinCollectAnim(e,t,a,i=10,s){let n=i;for(var r=0;r<i;r++){let i=Laya.Pool.getItemByClass("coin",Laya.Image);i.skin="mainUI/sy-jb.png",i.x=e.x,i.y=e.y,a.addChild(i);let r=300+100*Math.random()-50;Laya.Tween.to(i,{x:i.x+250*Math.random()-125,y:i.y+250*Math.random()-125},r),Laya.timer.once(r+50,this,function(){Laya.Tween.to(i,{x:t.x,y:t.y},400,null,new Laya.Handler(this,function(){a.removeChild(i),Laya.Pool.recover("coin",i),0==--n&&s&&s()}))})}}static scaleLoop(e,t,a){Laya.Tween.to(e,{scaleX:t,scaleY:t},a,null,new Laya.Handler(this,()=>{Laya.Tween.to(e,{scaleX:1,scaleY:1},a,null,new Laya.Handler(this,()=>{this.scaleLoop(e,t,a)}))}))}static rotateLoop(e,t,a){Laya.Tween.to(e,{rotation:t},a,null,new Laya.Handler(this,()=>{Laya.Tween.to(e,{rotation:-t},2*a,null,new Laya.Handler(this,()=>{Laya.Tween.to(e,{rotation:0},a,null,new Laya.Handler(this,()=>{this.rotateLoop(e,t,a)}))}))}))}static visibleDelay(e,t){e.visible=!1,Laya.timer.once(t,this,()=>{e.visible=!0})}}class t{constructor(){this.grade=1,this.gradeIndex=0,this.power=10,this.playerCountLv=1,this.playerPowerLv=1,this.playerOfflineLv=1,this.coin=0,this.playerId=0,this.playerArr=[],this.unlockSkinCount=0,this.exitTime=0}}class a{static getPlayerData(){if(localStorage.getItem("playerData"))null==this._playerData&&(this._playerData=JSON.parse(localStorage.getItem("playerData")));else{this._playerData=new t;for(let e=0;e<27;e++)0==e?this._playerData.playerArr.push(0):this._playerData.playerArr.push(-1);localStorage.setItem("playerData",JSON.stringify(this._playerData))}return this._playerData}static setPlayerData(){localStorage.setItem("playerData",JSON.stringify(this._playerData))}static getPlayerYet(){let e=[];for(let t=0;t<this._playerData.playerArr.length;t++)this._playerData.playerArr[t]<0&&e.push(t);return e}static getCoinSkins(){let e=[].concat(this.skinArr1),t=[];for(let a=0;a<e.length;a++)this._playerData.playerArr[a]<0&&t.push(e[a]);return t}static getVideoSkins(){let e=[].concat(this.skinArr2),t=[];for(let a=0;a<e.length;a++)this._playerData.playerArr[a+9]<0&&t.push(e[a]);return t}static getFreeSkins(){let t=[].concat(this.skinArr1,this.skinArr2,this.skinArr3);t=e.shuffleArr(t);let a=[];for(let e=0;e<t.length;e++){let i=this.getPlayerArrIndexByValue(t[e]);if(this._playerData.playerArr[i]<0&&(a.push(t[e]),a.length>=4))break}return a}static getBoxSkins(){let e=[].concat(this.skinArr3),t=[];for(let a=0;a<e.length;a++)this._playerData.playerArr[a+18]<0&&t.push(e[a]);return t}static changeCoin(e){this._playerData.coin+=e,this.setPlayerData()}static getPlayerSkin(e,t){this._playerData.playerArr[e]=t,this._playerData.playerId=t,this.setPlayerData()}static getPlayerCountLv(){return this._playerData.playerCountLv}static upgradePlayerCountLv(){this._playerData.playerCountLv>=5||(this._playerData.playerCountLv+=1,this.setPlayerData())}static getPlayerCount(){return this._playerData.playerCountLv}static getCountLvMax(){return this._playerData.playerCountLv>=5}static getPlayerPowerLv(){return this._playerData.playerPowerLv}static upgradePlayerPowerLv(){this._playerData.playerPowerLv>=35||(this._playerData.playerPowerLv+=1,this.setPlayerData())}static getPlayerPowerData(){let e={hp:125,atk:20};return e.hp=125+4*(this._playerData.playerPowerLv-1),e.atk=20+2*(this._playerData.playerPowerLv-1),e}static getPowerLvMax(){return this._playerData.playerPowerLv>=35}static getPlayerOfflineLv(){return this._playerData.playerOfflineLv}static upgradePlayerOfflineLv(){this._playerData.playerOfflineLv>=56||(this._playerData.playerOfflineLv+=1,this.setPlayerData())}static getPlayerOffline(e){return Math.floor(e*(1+.05*(this._playerData.playerOfflineLv-1)))}static getOfflineLvMax(){return this._playerData.playerOfflineLv>=56}static getNpcData(){let e={hp:100,atk:10},t=Math.floor((this._playerData.grade-1)/5)+1;return e.hp=100+10*(t-1),e.atk=10+5*(t-1),e.hp>240&&(e.hp=240),e.atk>90&&(e.atk=90),e}static getUpgradePlayerCountLvCost(){let e=100;return e=100+500*(this.getPlayerCountLv()-1)}static getUpgradePlayerPowerLvCost(){let e=50;return e=50+50*(this.getPlayerPowerLv()-1)}static getUpgradeOfflineLvCost(){let e=50;return e=50+50*(this.getPlayerOfflineLv()-1)}static getUnlockSkinCost(){return 100+100*this._playerData.unlockSkinCount}static getHeroSkinDir(e){return"heroSkins/Hero_"+(e+1)+".png"}static setExitTime(){this._playerData.exitTime=(new Date).getTime(),this.setPlayerData()}static getPlayerArrIndexByValue(e){for(let t=0;t<this.skinArr1.length;t++)if(-1!=this.skinArr1.indexOf(e))return this.skinArr1.indexOf(e);for(let t=0;t<this.skinArr2.length;t++)if(-1!=this.skinArr2.indexOf(e))return this.skinArr2.indexOf(e)+9;for(let t=0;t<this.skinArr3.length;t++)if(-1!=this.skinArr3.indexOf(e))return this.skinArr3.indexOf(e)+18;return-1}}a._playerData=null,a.tempSkinId=-1,a.aiConfig=null,a.posConfig=null,a.freeSkinId=-1,a.skinArr1=[0,1,2,8,9],a.skinArr2=[3,4],a.skinArr3=[5,6,7],a.skinArr4=[8,9];class i{static httpRequest(e,t,a="get",i){var s=new Laya.HttpRequest;s.http.timeout=5e3,s.once(Laya.Event.COMPLETE,this,i),s.once(Laya.Event.ERROR,this,this.httpRequest,[e,t,a,i]),"get"==a?s.send(e+"?"+t,"",a,"text"):"post"==a&&s.send(e,JSON.stringify(t),a,"text")}static shuffleArr(e){let t=e.length;for(;t;){let a=Math.floor(Math.random()*t--);[e[a],e[t]]=[e[t],e[a]]}return e}static fixNodeY(e){e.y=e.y*Laya.stage.displayHeight/Laya.stage.designHeight}static visibleDelay(e,t=1500){e.visible=!1,Laya.timer.once(t,this,()=>{e.visible=!0})}static tMove(e,t,a,i,s){Laya.Tween.to(e,{x:t,y:a},i,null,new Laya.Handler(this,()=>{s&&s()}))}}var s,n;!function(e){e.SCENE_FRIENDGAME="JJExport/FriendGameUI.scene",e.SCENE_SCROLLUI="JJExport/ScrollUI.scene",e.SCENE_RECOMMENDUI="JJExport/RecommendUI.scene",e.SCENE_FULLGAMEUI="JJExport/FullGameUI.scene",e.SCENE_FINISHGAMEUI="JJExport/FinishGameUI.scene",e.SCENE_DRAWUI="JJExport/DrawUI.scene",e.SCENE_NEWGAMEUI="JJExport/NewGameUI.scene",e.SCENE_PROGRAMUI="JJExport/ProgramUI.scene"}(s||(s={}));class r{constructor(){this.dataConfig={allow_share:!0,front_allow_return:!0,front_banner_number:8,front_banner_second:800,front_button_second:300,front_ckin_banner_move:700,front_ckin_banner_second:500,front_direct_draw:!0,front_extra_share:!1,front_home_screen_level:10,front_home_screen_number:5,front_lucky_screen_chance:50,front_lucky_screen_level:20,front_lucky_screen_number:5,front_pass_gate:10,front_proceed_game:1e3,front_proceed_history:1,front_share_config:{image:"https://oss.99huyu.cn/wxhuyu/a1f98703efb3f3bfe2b9a4d5a250f926.png",title:"根据实际年纪看看你该在啥水平..."},front_share_number:4,is_allow_area:1},this.navDataArr=[],this.JJConfigUrl="https://jiujiu.99huyu.cn/qq/weapon/config.json",this.isFinished=!1}static get instance(){return this._instance||(this._instance=new r),this._instance}canShowFullScreen(e){return e>=this.dataConfig.front_auto_remen_level}initJJ(e="1.0.0",t){i.httpRequest(this.JJConfigUrl,"version="+e,"get",e=>{e=JSON.parse(e),console.log("JJ config.json:",e),this.dataConfig=e.data.config,this.isFinished=!0,t&&t()})}openScene(e,t=!1,a,i){Laya.Scene.open(e,t,a,Laya.Handler.create(this,e=>{i&&i.addChild(e)}))}closeScene(e){Laya.Scene.close(e)}NavigateApp(e,t,a,i){if(Laya.Browser.onWeiXin){switch(Laya.Browser.window.qq.aldSendEvent("导出-总点击数"),i){case s.SCENE_DRAWUI:Laya.Browser.window.qq.aldSendEvent("抽屉页面-总点击数");break;case s.SCENE_FINISHGAMEUI:break;case s.SCENE_FRIENDGAME:Laya.Browser.window.qq.aldSendEvent("好友都在玩的爆款游戏弹-总点击数");break;case s.SCENE_FULLGAMEUI:Laya.Browser.window.qq.aldSendEvent("全屏幕导出页-总点击数");break;case s.SCENE_RECOMMENDUI:Laya.Browser.window.qq.aldSendEvent("热门推荐全屏幕导出页-总点击数");break;case s.SCENE_SCROLLUI:break;case s.SCENE_PROGRAMUI:Laya.Browser.window.qq.aldSendEvent("游戏历史列表导出页-总点击数")}Laya.Browser.window.qq.navigateToMiniProgram({appId:this.navDataArr[e].appid,path:this.navDataArr[e].path,success:t=>{switch(a&&a(),Laya.Browser.window.qq.aldSendEvent("导出成功-总用户数"),Laya.Browser.window.qq.aldSendEvent("导出成功-"+this.navDataArr[e].title),console.log("导出成功-"+this.navDataArr[e].title),i){case s.SCENE_DRAWUI:Laya.Browser.window.qq.aldSendEvent("抽屉页面-总成功跳转数");break;case s.SCENE_FINISHGAMEUI:break;case s.SCENE_FRIENDGAME:Laya.Browser.window.qq.aldSendEvent("好友都在玩的爆款游戏弹-总成功跳转数");break;case s.SCENE_FULLGAMEUI:Laya.Browser.window.qq.aldSendEvent("全屏幕导出页-总成功跳转数");break;case s.SCENE_RECOMMENDUI:Laya.Browser.window.qq.aldSendEvent("热门推荐全屏幕导出页-总成功跳转数");break;case s.SCENE_SCROLLUI:break;case s.SCENE_PROGRAMUI:Laya.Browser.window.qq.aldSendEvent("游戏历史列表导出页-总成功跳转数")}},fail:e=>{t&&t()}})}}getTitle(e,t=!0){return t&&this.navDataArr[e].subtitle&&""!=this.navDataArr[e].subtitle?this.navDataArr[e].subtitle:this.navDataArr[e].title}}class o{static get instance(){return this._instance||(this._instance=new o),this._instance}initLoading(e){var t=[{url:"res/sounds/bgm.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/castleHit1.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/castleHit2.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/castleHit3.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/die1.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/die2.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/getCoin.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/weaponHit1.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/weaponHit2.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/weaponHit3.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/weaponHit4.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/weaponReady.mp3",type:Laya.Loader.SOUND}];Laya.loader.load(t,Laya.Handler.create(this,e)),Laya.SoundManager.useAudioMusic=!0,Laya.SoundManager.setMusicVolume(1)}playMusic(e,t=0,a){Laya.SoundManager.playMusic("res/sounds/"+e,t,new Laya.Handler(this,a))}stopMusic(){Laya.SoundManager.stopMusic()}playSoundEffect(e,t=1,a){Laya.SoundManager.playSound("res/sounds/"+e,t,new Laya.Handler(this,a))}}class h{constructor(){this.path="",this.picCount=3,this.preT=0,this.shareTips=["请分享到活跃的群！","请分享到不同群！","请分享给好友！","请分享给20人以上的群！"]}static get instance(){return this._instance||(this._instance=new h),this._instance}initShare(){if(Laya.Browser.onWeiXin){Laya.Browser.window.qq.showShareMenu({withShareTicket:!0});let e=r.instance.dataConfig.front_share_config.image,t=r.instance.dataConfig.front_share_config.title;Laya.Browser.window.qq.onShareAppMessage(function(a){return{title:t,imageUrl:e}}),Laya.Browser.window.qq.onShow(e=>{if(o.instance.playMusic("bgm.mp3"),c.shareCallback){((new Date).getTime()-c.shareTime)/1e3>=3&&!c.firstShare?(c.shareCallback(),c.front_share_number--,Laya.Browser.window.qq.showToast({title:"分享成功",icon:"none",duration:2e3}),c.shareCallback=null):(c.firstShare=!1,Laya.Browser.window.qq.showModal({title:"提示",content:this.shareTips[Math.floor(Math.random()*this.shareTips.length)],confirmText:"重新分享",success(e){e.confirm?(console.log("用户点击确定"),h.instance.shareGame(c.shareCallback)):e.cancel&&console.log("用户点击取消")}}))}})}}shareGame(e){if(c.front_share_number<=0)return void l.instance.showVideo(e);if(c.shareCallback=e,!Laya.Browser.onWeiXin)return void e();c.shareTime=(new Date).getTime();let t=r.instance.dataConfig.front_share_config.image,a=r.instance.dataConfig.front_share_config.title;Laya.Browser.window.qq.shareAppMessage({title:a,imageUrl:t})}}class l{constructor(){this.bannerUnitId=["947d377267bea06eb446afe81328d792","8a7c0bf18bb869abc182b7110fd70145"],this.videoUnitId="32351da471a086273478425fb7f99aab",this.appBoxUnitId="e72c06906c7b12b06cfe70145816b8ed",this.bannerAd=null,this.videoAd=null,this.blockAd=null,this.videoCallback=null,this.curBannerId=0,this.showBannerCount=0,this.isBannerError=!1,this.appBox=null,this.videoIsError=!1,this.videoLoaded=!1,this.isCreateBAD=!1,this.appBoxCloseCB=null}static get instance(){return this._instance||(this._instance=new l),this._instance}initAd(){Laya.Browser.onWeiXin&&(this.initBanner(),this.initVideo(),this.initAppBox())}initAppBox(e=!1){if(Laya.Browser.onWeiXin){let t=this;this.appBox=Laya.Browser.window.qq.createAppBox({adUnitId:this.appBoxUnitId}),this.appBox.load().then(()=>{e&&this.appBox.show()}),this.appBox.offClose(),this.appBox.onClose(()=>{null!=t.appBoxCloseCB&&t.appBoxCloseCB&&t.appBoxCloseCB(),t.closeAppBox()})}}showAppBox(e){this.appBoxCloseCB=e,Laya.Browser.onWeiXin&&this.appBox?this.appBox.show():Laya.Browser.onWeiXin&&!this.appBox&&this.initAppBox(!0),Laya.Browser.onWeiXin&&this.showBanner()}closeAppBox(){Laya.Browser.onWeiXin&&this.appBox&&(this.appBox.destroy(),this.appBox=null,this.appBoxCloseCB=null,this.hideBanner())}initBanner(){let e=!1;Laya.Browser.onWeiXin&&Laya.Browser.window.qq.getSystemInfo({success:t=>{-1!=t.model.search("iPhone X")&&(e=!0)}});let t=Laya.Browser.window.qq.getSystemInfoSync();this.bannerAd=Laya.Browser.window.qq.createBannerAd({adUnitId:this.bannerUnitId[this.curBannerId],style:{left:0,top:0,width:750,height:0}}),this.bannerAd.onResize(a=>{this.bannerAd.style.top=e?t.windowHeight-a.height-10:t.windowHeight-a.height,this.bannerAd.style.left=t.windowWidth/2-a.width/2}),this.bannerAd.onError(e=>{console.log("banner error:",JSON.stringify(e)),this.isBannerError=!0})}hideBanner(e=!0){Laya.Browser.onWeiXin&&(this.bannerAd.hide(),null!=r.instance.dataConfig&&this.showBannerCount>=parseInt(r.instance.dataConfig.front_banner_number)&&(this.showBannerCount=0,this.curBannerId++,this.curBannerId>=this.bannerUnitId.length&&(this.curBannerId=0),console.log("destroy banner"),this.bannerAd.destroy(),this.bannerAd=null,this.initBanner()))}showBanner(){Laya.Browser.onWeiXin&&(this.showBannerCount++,this.bannerAd.show(),console.log("showBanner :",this.showBannerCount))}destroyBanner(){Laya.Browser.onWeiXin&&this.bannerAd&&(this.bannerAd.destroy(),this.bannerAd=null)}initVideo(){Laya.Browser.onWeiXin&&(this.videoAd||(this.videoAd=Laya.Browser.window.qq.createRewardedVideoAd({adUnitId:this.videoUnitId})),this.loadVideo(),this.videoAd.onLoad(()=>{console.log("激励视频加载成功"),this.videoLoaded=!0}),this.videoAd.onError(e=>{console.log("video Error:",JSON.stringify(e)),this.videoIsError=!0}))}loadVideo(){Laya.Browser.onWeiXin&&null!=this.videoAd&&(this.videoIsError=!1,this.videoAd.load())}showVideo(e){if(this.videoCallback=e,Laya.Browser.onWeiXin)return this.videoIsError?(h.instance.shareGame(e),void this.loadVideo()):void(0!=this.videoLoaded?(this.videoAd&&this.videoAd.offClose(),Laya.SoundManager.muted=!0,this.videoAd.onClose(e=>{e&&e.isEnded||void 0===e?(console.log("正常播放结束，可以下发游戏奖励"),this.videoCallback()):console.log("播放中途退出，不下发游戏奖励"),Laya.SoundManager.muted=!1,l.instance.loadVideo()}),this.videoAd.show()):c.OpenAlert("视频正在加载中！"));this.videoCallback()}}class c{static LoginWx(e){if(!Laya.Browser.onWeiXin)return;let t=Laya.Browser.window.qq.getLaunchOptionsSync();Laya.Browser.window.qq.login({success(a){a.code&&(console.log("res.code:",a.code),e&&e(a.code,t.query))}})}static checkScope(e){Laya.Browser.onWeiXin&&Laya.Browser.window.qq.getSetting({success:t=>{t.authSetting["scope.userInfo"]?console.log("已经授权"):(console.log("没有授权"),this.createScope(e))}})}static createScope(e){this.scopeBtn=Laya.Browser.window.qq.createUserInfoButton({type:"text",text:"",style:{left:e.x,top:e.y,width:e.width,height:e.height,lineHeight:40,backgroundColor:"#ffffff",color:"#ffffff",textAlign:"center",fontSize:16,borderRadius:0}}),this.scopeBtn.onTap(e=>{"getUserInfo:ok"==e.errMsg?(this.scopeBtn.destroy(),this.scopeBtn=null):"getUserInfo:fail auth deny"==e.errMsg&&(this.scopeBtn.destroy(),this.scopeBtn=null)})}static GetLaunchParam(e){Laya.Browser.onWeiXin&&(this.OnShowFun=e,e(this.GetLaunchPassVar()),Laya.Browser.window.qq.onShow(e=>{null!=this.OnShowFun&&this.OnShowFun(e),console.log("wx on show")}))}static GetLaunchPassVar(){return Laya.Browser.onWeiXin?Laya.Browser.window.qq.getLaunchOptionsSync():null}static WxOnHide(e){Laya.Browser.onWeiXin&&Laya.Browser.window.qq.onHide(e)}static allowScene(){let e=r.instance.dataConfig.front_openwuchu_scene.toString();if(-1==e.search("|")){return parseInt(e)==c.sceneId}let t=e.split("|");for(let e=0;e<t.length;e++){if(parseInt(t[e])==c.sceneId)return!0}return!1}static httpRequest(e,t,a="get",i){var s=new Laya.HttpRequest;s.http.timeout=5e3,s.once(Laya.Event.COMPLETE,this,i),s.once(Laya.Event.ERROR,this,this.httpRequest,[e,t,a,i]),"get"==a?s.send(e+"?"+t,"",a,"text"):"post"==a&&s.send(e,JSON.stringify(t),a,"text")}static DoVibrate(e=!0){Laya.Browser.onWeiXin&&this.isVibrate&&(e?Laya.Browser.window.qq.vibrateShort():Laya.Browser.window.qq.vibrateLong())}static OpenAlert(e,t=2e3,a=!1){Laya.Browser.onWeiXin&&Laya.Browser.window.qq.showToast({title:e,duration:t,mask:!1,icon:a?"success":"none"})}static NavigateApp(e,t,a,i,s){if(Laya.Browser.onWeiXin){Laya.Browser.window.qq.navigateToMiniProgram({appId:e,path:t,success(e){console.log("打开成功"),s()},fail(e){console.log("打开失败"),i()}})}}static preViewImage(e){Laya.Browser.onWeiXin&&Laya.Browser.window.qq.previewImage({current:e,urls:[e]})}static aldEvent(e){}static fixBtnTouchPos(e,t,a,i,s){c.isValidBanner()?(e.y=t*Laya.stage.displayHeight/1334,Laya.timer.once(1100,i,()=>{l.instance.showBanner()}),Laya.timer.once(1350,i,()=>{e.y=a,s&&s()})):(l.instance.showBanner(),s&&s())}static isValidBanner(){return a.getPlayerData().grade>=r.instance.dataConfig.front_pass_gate&&1==r.instance.dataConfig.is_allow_area&&c.isWhiteList}static calculateShareNumber(){localStorage.getItem("lastDate")&&(new Date).getDate()==parseInt(localStorage.getItem("lastDate"))?this.front_share_number=parseInt(localStorage.getItem("front_share_number")):this.front_share_number=r.instance.dataConfig.front_share_number,console.log("this.front_share_number:",this.front_share_number)}}c.UnityPath="LayaScene_MyScene/Conventional/",c.sceneId=0,c.isWhiteList=!1,c.openId="",c.version="1.0.3",c.isVibrate=!0,c.isMusic=!0,c.OnShowFun=null,c.scopeBtn=null,c.shareCallback=null,c.front_share_number=0,c.gotOfflineBounes=!1,c.configData=null,c.shareTime=0,c.firstShare=!0,c.hadShowFriendUI=!1,c.launchGameUI=!1,c.firstStartGame=!1,c.isKillBossUI=!1,c.fromKillBossUI=!1,c.isShowAppBox=!1,c.tempGrade=1;class d extends Laya.Script{constructor(){super(),this.myOwner=null,this._ani=null,this.isHited=!1,this.isDied=!1,this.hp=100}onAwake(){this.myOwner=this.owner,this._ani=this.owner.getComponent(Laya.Animator)}onDisable(){}playDied(){this._ani.speed=1,this._ani.crossFade("Take 001",.05)}hitBack(t){if(this.isDied||this.isHited)return;let a=e.GetRandom(1,3);if(o.instance.playSoundEffect("castleHit"+a+".mp3"),c.DoVibrate(),e.objectShake(this.myOwner,.2,.1),this.hp-=t,this.hp<=0)return this.isDied=!0,this.playDied(),void Laya.timer.once(1e3,this,()=>{this.owner.destroy()});this.isHited=!0,Laya.timer.once(500,this,()=>{this.isHited=!1})}}class y{constructor(){this.tCount=0,y.Share=this,this.init()}init(){localStorage.getItem("powerTime")?this.tCount=parseInt(localStorage.getItem("powerTime")):localStorage.setItem("power","0"),this.calculateExitTime(),Laya.Browser.onWeiXin&&(Laya.Browser.window.qq.onShow(e=>{this.calculateExitTime()}),Laya.Browser.window.qq.onHide(e=>{localStorage.setItem("powerTime",this.tCount.toString()),localStorage.setItem("exitTime",(new Date).getTime().toString())})),Laya.timer.loop(1e3,this,this.calculateTime)}calculateExitTime(){let e=0;if(localStorage.getItem("exitTime")&&(e=(new Date).getTime()-parseInt(localStorage.getItem("exitTime"))),e<=0)return;e/=1e3;let t=Math.floor(e/600);a.getPlayerData().power+=t,a.getPlayerData().power>10&&(a.getPlayerData().power=10,a.setPlayerData())}calculateTime(){this.tCount<=0?a.getPlayerData().power<10?this.tCount=600:this.tCount=0:(this.tCount--,this.tCount<=0&&a.getPlayerData().power<10&&(a.getPlayerData().power+=1,a.setPlayerData(),this.tCount=a.getPlayerData().power<10?600:0))}}class p extends Laya.Script{constructor(){super()}onEnable(){p.Share=this,this.calculateTime(),Laya.timer.loop(1e3,this,this.calculateTime),this.initData()}initData(){this.coinNum.value=a.getPlayerData().coin.toString(),this.powerNum.value=a.getPlayerData().power.toString(),this.gradeNum.text=a.getPlayerData().grade.toString(),this.bar.width=(a.getPlayerData().gradeIndex+1)/4*480,this.bossPic.visible=this.bar.width>=480;let e=0==Math.floor(a.getPlayerData().grade%4)?4:Math.floor(a.getPlayerData().grade%4);for(let t=0;t<this.keyNode.numChildren;t++){this.keyNode.getChildAt(t).skin=e>t+1?"mainUI/sy-ys1.png":"mainUI/sy-ys2.png"}}onDisable(){Laya.timer.clearAll(this)}calculateTime(){let e=y.Share.tCount,t=Math.floor(e/60),i=Math.floor(e-60*t);this.powerTime.text=t.toString()+":"+i.toString(),this.powerNum.value=a.getPlayerData().power.toString(),this.powerTime.visible=a.getPlayerData().power<10}}!function(e){e.HpBar="prefab/hpBar.prefab",e.Smile="prefab/smile.prefab",e.Cry="prefab/cry.prefab",e.Coin="prefab/coinEffect.prefab"}(n||(n={}));class g{constructor(){this.init(),Laya.loader.load(this.url,Laya.Handler.create(this,this.loadComplete),Laya.Handler.create(this,this.loadProgress),Laya.Loader.PREFAB)}static instance(){return g._instance?g._instance:g._instance=new g}init(){this.url=[];for(let e in n)this.url.push(n[e])}getItem(e){let t=Laya.loader.getRes(e);return t?Laya.Pool.getItemByCreateFun(e,t.create,t):null}recoverItem(e,t){Laya.Pool.recover(e,t)}loadProgress(e){console.log("预制体资源加载中...",e)}loadComplete(){console.log("预制体资源加载完成!")}}class u extends Laya.Script{constructor(){super(),this.playerNode=null,this.playerCrl=null,this.ready=!1}onAwake(){this.myOwner=this.owner}onDisable(){}initData(e){this.playerNode=e,this.ready=!0,this.playerCrl=this.playerNode.getComponent(B)}onUpdate(){if(!this.ready)return;if(null==this.playerNode.transform||null==this.playerNode.transform)return void this.myOwner.destroy();this.myOwner.value=this.playerCrl.hp/this.playerCrl.hpMax;let e=new Laya.Vector4(0,0,0),t=this.playerNode.transform.position.clone();this.playerCrl.isPlayer?t.z-=1:t.y+=4,f.Share._camera.viewport.project(t,f.Share._camera.projectionViewMatrix,e),this.myOwner.pos(e.x/Laya.stage.clientScaleX,e.y/Laya.stage.clientScaleY)}}class m extends Laya.Script{constructor(){super(),this.playerNode=null,this.playerCrl=null,this.ready=!1}onAwake(){this.myOwner=this.owner}onDisable(){}initData(e){this.playerNode=e,this.playerCrl=this.playerNode.getComponent(B),this.ready=!0,Laya.timer.once(2e3,this,()=>{this.myOwner.destroy()})}onUpdate(){if(!this.ready)return;if(null==this.playerNode.transform||null==this.playerNode.transform)return void this.myOwner.destroy();let e=new Laya.Vector4(0,0,0),t=this.playerNode.transform.position.clone();t.y+=3.5,f.Share._camera.viewport.project(t,f.Share._camera.projectionViewMatrix,e),this.myOwner.pos(e.x/Laya.stage.clientScaleX,e.y/Laya.stage.clientScaleY)}}class L extends Laya.Scene{constructor(){super(),this.touchPanel=this.touchPanel,this.touchNode=this.touchNode,this.drawSp=this.drawSp,this.btnNode=this.btnNode,this.noPowerNode=this.noPowerNode,this.upgradeNode=this.upgradeNode,this.closeUpgradePlane=this.closeUpgradePlane,this.moveNode=this.moveNode,this.item1=this.item1,this.item2=this.item2,this.item3=this.item3,this.getPowerBtn=this.getPowerBtn,this.upgradeBtn=this.upgradeBtn,this.skinBtn=this.skinBtn,this.reviveBtn=this.reviveBtn,this.startBtn=this.startBtn,this.overNode=this.overNode,this.bottomNode=this.bottomNode,this.gameOverNode=this.gameOverNode,this.helpBtn=this.helpBtn,this.giveUpBtn=this.giveUpBtn,this.gameOverBtnNode=this.gameOverBtnNode,this.playerHp=this.playerHp,this.aiHp=this.aiHp,this.moreGameBtn=this.moreGameBtn,this.getBounesBtn=this.getBounesBtn,this.touchStarted=!1,this.startPos=null,this.lineArr=[],this.lineArrVec2=[]}onOpened(e){L.Share=this,this.initData(),e&&e(),Laya.timer.frameLoop(1,this,this.checkIsNoPower);let t=!1;c.launchGameUI||(c.GetLaunchParam(e=>{let i=a.getPlayerData().exitTime;if(i>0){let e=(new Date).getTime(),a=Math.floor((e-i)/1e3/60);a>=1&&(Laya.Scene.open("MyScenes/OfflineUI.scene",!1,a),t=!0)}}),c.launchGameUI=!0,f.Share.checkCanUpgrade()),!t&&localStorage.getItem("lastDate")&&!c.isShowAppBox&&r.instance.dataConfig.front_box_ads&&(c.isShowAppBox=!0,l.instance.showAppBox()),this.drawTips.visible=a.getPlayerData().grade<=2,this.drawTips.skin=1==a.getPlayerData().grade?"mainUI/sy_ck2.png":"mainUI/sy_ck1.png",localStorage.getItem("guide")||1!=a.getPlayerData().grade?this.fingerAni.visible=!1:this.fingerAni.visible=!0,o.instance.playMusic("bgm.mp3"),f.Share.isBanGameUIBanner?f.Share.isBanGameUIBanner=!1:l.instance.hideBanner(!1)}onClosed(){Laya.timer.clearAll(this)}initData(){this.touchPanel.y=e.fixPosY(this.touchPanel.y),this.bottomNode.y=e.fixPosY(this.bottomNode.y),this.gameOverBtnNode.y=e.fixPosY(this.gameOverBtnNode.y),this.touchNode.on(Laya.Event.MOUSE_DOWN,this,this.touchStart),this.touchNode.on(Laya.Event.MOUSE_MOVE,this,this.touchMove),this.touchNode.on(Laya.Event.MOUSE_UP,this,this.touchEnd),this.touchNode.on(Laya.Event.MOUSE_OUT,this,this.touchOut),this.upgradeBtn.on(Laya.Event.CLICK,this,this.upgradeBtnCB),this.skinBtn.on(Laya.Event.CLICK,this,this.skinBtnCB),this.item1.on(Laya.Event.CLICK,this,this.upgradePlayerCountCB),this.item2.on(Laya.Event.CLICK,this,this.upgradePlayerAtkCB),this.item3.on(Laya.Event.CLICK,this,this.upgradeOfflineCB),this.reviveBtn.on(Laya.Event.CLICK,this,this.reviveBtnCB),this.startBtn.on(Laya.Event.CLICK,this,this.startCB),this.helpBtn.on(Laya.Event.CLICK,this,this.helpBtnCB),this.giveUpBtn.on(Laya.Event.CLICK,this,this.giveUpBtnCB),this.getPowerBtn.on(Laya.Event.CLICK,this,this.getPowerBtnCB),this.moreGameBtn.on(Laya.Event.CLICK,this,this.moreGameBtnCB),e.rotateLoop(this.moreGameBtn.getChildAt(0),15,100),this.getBounesBtn.on(Laya.Event.CLICK,this,this.getBounesBtnCB),e.rotateLoop(this.getBounesBtn.getChildAt(0),15,100),this.updatePlayerItem(),Laya.timer.loop(1e3,this,this.updatePlayerItem),f.Share.canTouch=!0}moreGameBtnCB(){l.instance.showAppBox()}updatePlayerItem(){let e=null,t=!1;for(let i=1;i<=3;i++){let s=(e=this["item"+i]).getChildByName("lvNum"),n=e.getChildByName("cost"),r=e.getChildByName("panel");switch(i){case 1:s.text="等级："+a.getPlayerCountLv().toString(),n.text=a.getUpgradePlayerCountLvCost().toString(),r.visible=a.getUpgradePlayerCountLvCost()>a.getPlayerData().coin||a.getCountLvMax();break;case 2:s.text="等级："+a.getPlayerPowerLv().toString(),n.text=a.getUpgradePlayerPowerLvCost().toString(),r.visible=a.getUpgradePlayerPowerLvCost()>a.getPlayerData().coin||a.getPowerLvMax();break;case 3:s.text="等级："+a.getPlayerOfflineLv().toString(),n.text=a.getUpgradeOfflineLvCost().toString(),r.visible=a.getUpgradeOfflineLvCost()>a.getPlayerData().coin||a.getOfflineLvMax()}r.visible||(t=!0)}this.upgradeBtn.getChildAt(0).visible=t}touchStart(e){this.safeArea(new Laya.Vector2(e.stageX,e.stageY))&&f.Share.canTouch&&(this.fingerAni.visible=!1,localStorage.getItem("guide")||localStorage.setItem("guide","1"),0!=a.getPlayerData().gradeIndex||f.Share.gameStarted||(a.getPlayerData().power--,a.setPlayerData(),f.Share.gameStarted=!0),this.touchStarted=!0,this.startPos=new Laya.Vector2(e.stageX,e.stageY),this.lineArr=[],this.lineArr.push(this.startPos.x),this.lineArr.push(this.startPos.y),this.lineArrVec2=[],this.lineArrVec2.push(this.startPos))}touchMove(t){if(!this.safeArea(new Laya.Vector2(t.stageX,t.stageY))||!this.touchStarted)return;let a=new Laya.Vector2(t.stageX,t.stageY);e.calcDistance(this.startPos,a)>=10&&this.lineArrVec2.length<f.WEAPON_LENGTH_MAX&&(this.lineArr.push(a.x),this.lineArr.push(a.y),this.lineArrVec2.push(a),this.startPos=a,this.drawLine())}touchEnd(e){this.touchStarted&&(this.touchStarted=!1,this.drawSp.graphics.clear(),this.lineArrVec2.length<f.WEAPON_LENGTH_MIN?c.OpenAlert("武器太短啦，请重画！"):f.Share.createLine3D(this.lineArrVec2))}touchOut(e){this.touchStarted&&(this.touchStarted=!1,this.drawSp.graphics.clear(),this.lineArrVec2.length<f.WEAPON_LENGTH_MIN?c.OpenAlert("武器太短啦，请重画！"):f.Share.createLine3D(this.lineArrVec2))}drawLine(){this.drawSp.graphics.clear(),this.drawSp.graphics.drawLines(0,0,this.lineArr,"#000000",8)}safeArea(e){let t=this.touchPanel.x-this.touchPanel.width/2,a=this.touchPanel.x+this.touchPanel.width/2,i=this.touchPanel.y-this.touchPanel.height/2,s=this.touchPanel.y+this.touchPanel.height/2;return!(e.x<t||e.x>a||e.y<i||e.y>s)}upgradeBtnCB(){this.upgradeNode.visible||(c.aldEvent("首页升级按钮：点击"),this.upgradeNode.visible=!0,e.tMove2D(this.moveNode,-606,this.moveNode.y,200,()=>{this.closeUpgradePlane.off(Laya.Event.CLICK,this,this.closeUpgradeNode),this.closeUpgradePlane.on(Laya.Event.CLICK,this,this.closeUpgradeNode)}))}closeUpgradeNode(){this.closeUpgradePlane.off(Laya.Event.CLICK,this,this.closeUpgradeNode),e.tMove2D(this.moveNode,0,this.moveNode.y,200,()=>{this.upgradeNode.visible=!1})}skinBtnCB(){console.log("点击皮肤按钮"),c.aldEvent("皮肤界面：点击"),Laya.Scene.open("MyScenes/SkinUI.scene",!1,()=>{})}upgradePlayerCountCB(){console.log("点击升级人数"),a.getPlayerCountLv()>=5||(a.getPlayerData().coin<a.getUpgradePlayerCountLvCost()?c.OpenAlert("金币不足！"):(c.aldEvent("升级界面：人数"),a.changeCoin(-a.getUpgradePlayerCountLvCost()),a.upgradePlayerCountLv(),this.updatePlayerItem(),f.Share.upgradePlayerCount(),p.Share.initData()))}upgradePlayerAtkCB(){console.log("点击升级攻击力"),a.getPlayerPowerLv()>=35||(a.getPlayerData().coin<a.getUpgradePlayerPowerLvCost()?c.OpenAlert("金币不足！"):(c.aldEvent("升级界面：攻击力"),a.changeCoin(-a.getUpgradePlayerPowerLvCost()),a.upgradePlayerPowerLv(),this.updatePlayerItem(),p.Share.initData()))}upgradeOfflineCB(){console.log("点击升级离线收益"),a.getPlayerOfflineLv()>=56||(a.getPlayerData().coin<a.getUpgradeOfflineLvCost()?c.OpenAlert("金币不足！"):(c.aldEvent("升级界面：离线收益"),a.changeCoin(-a.getUpgradeOfflineLvCost()),a.upgradePlayerOfflineLv(),this.updatePlayerItem(),p.Share.initData()))}visibleOverNode(e){e&&c.aldEvent("复活战士按钮弹出展示"),this.touchPanel.visible=!e,this.overNode.visible=e,this.upgradeBtn.visible=!e,this.skinBtn.visible=!e}reviveBtnCB(){f.Share.revivePlayer(),this.visibleOverNode(!1)}startCB(){this.visibleOverNode(!1),f.Share.goAhead()}visibleBottomUI(e){this.touchPanel.visible=e,this.upgradeBtn.visible=e,this.skinBtn.visible=e,e?l.instance.hideBanner():f.Share.showBottomBanner?l.instance.showBanner():f.Share.showBottomBanner=!0}closeAppCB(){l.instance.closeAppBox(),Laya.timer.clear(this,this.closeAppCB),this.gameOverBtnNode.visible=!0,c.fixBtnTouchPos(this.giveUpBtn,320,132,this)}visibleGameOverNode(t){if(t&&!this.gameOverNode.visible){if(l.instance.hideBanner(),this.bounesCoin.visible=f.Share.gotKillBossBounes,r.instance.dataConfig.front_box_ads?(this.gameOverBtnNode.visible=!1,l.instance.showAppBox(()=>{l.instance.closeAppBox(),Laya.timer.clear(this,this.closeAppCB),this.gameOverBtnNode.visible=!0,c.fixBtnTouchPos(this.giveUpBtn,320,132,this)}),Laya.timer.once(7e3,this,this.closeAppCB)):c.fixBtnTouchPos(this.giveUpBtn,320,132,this),f.Share.gotKillBossBounes){f.Share.gotKillBossBounes=!1;let t=e.GetRandom(30,100);this.bounesCoin.text="成功领取"+t+"金币",e.tMove2D(this.bounesCoin,this.bounesCoin.x,this.bounesCoin.y-100,2e3,()=>{this.bounesCoin.visible=!1}),a.changeCoin(t)}}else t||(this.moreGameBtn.visible=!0,l.instance.hideBanner());this.gameOverNode.visible=t}helpBtnCB(){c.aldEvent("请求帮助：点击");h.instance.shareGame(()=>{c.aldEvent("请求帮助：成功"),this.visibleGameOverNode(!1),f.Share.isOver=!1,f.Share.isHelpStart=!0,f.Share.tempPlayerCount=1,f.Share.restartGame()})}giveUpBtnCB(){c.aldEvent("第"+a.getPlayerData().grade+"关：失败"),f.Share.isHelpStart=!1,f.Share.gradeIndex=0,a.getPlayerData().gradeIndex=0,a.setPlayerData(),this.visibleGameOverNode(!1),f.Share.restartGame(),r.instance.dataConfig.front_box_ads&&l.instance.showAppBox()}createHpBar(e){let t=g.instance().getItem(n.HpBar);this.playerHp.addChild(t),t.addComponent(u).initData(e)}createSmile(e){let t=g.instance().getItem(n.Smile);this.addChild(t),t.getComponent(m).initData(e)}createCry(e){let t=g.instance().getItem(n.Cry);this.addChild(t),t.getComponent(m).initData(e)}getPowerBtnCB(){c.aldEvent("获得体力：点击");h.instance.shareGame(()=>{c.aldEvent("获得体力：成功"),a.getPlayerData().power+=5,a.setPlayerData()})}checkIsNoPower(){if(0==a.getPlayerData().gradeIndex&&!f.Share.gameStarted&&!f.Share.isHelpStart){let e=a.getPlayerData().power;this.touchPanel.visible=e>0,this.touchNode.visible=e>0,this.noPowerNode.visible=e<=0}}createCoinBoom(t){let a=new Laya.Vector4(0,0,0),i=t.transform.position.clone();i.y+=1.75,f.Share._camera.viewport.project(i,f.Share._camera.projectionViewMatrix,a);let s=new Laya.Vector2(a.x/Laya.stage.clientScaleX,a.y/Laya.stage.clientScaleY),n=new Laya.Vector2(75,100);e.coinCollectAnim(s,n,this),p.Share.initData()}getBounesBtnCB(){Laya.Scene.open("MyScenes/OpenPacketsUI.scene",!1)}}class B extends Laya.Script{constructor(){super(),this.myOwner=null,this._ani=null,this.weaponNode=null,this.enemyNode=null,this.embNode=null,this.closeNode=null,this.isPlayer=!0,this.isHited=!1,this.haveWeapon=!1,this.isDied=!1,this.fightStarted=!1,this.weaponLength=5,this.walkSpeed=.08,this.myId=0,this.backDistance=8,this.weaponSpeed=1,this.hpMax=100,this.hp=100,this.atk=20,this.embScale=null,this.embPos=null,this.embRotation=null,this.isBossState=!1}onAwake(){this.myOwner=this.owner,this._ani=this.owner.getComponent(Laya.Animator),this.playIdle1(),this.weaponNode=e.findNodeByName(this.myOwner,"Dummy_Arms"),this.embNode=e.findNodeByName(this.myOwner,"Dummy_Emb");let t=e.findNodeByName(this.myOwner,"Hero1_Emb");this.embScale=t.transform.localScale.clone(),this.embPos=t.transform.localPosition.clone(),this.embRotation=t.transform.localRotation.clone()}initData(e,t){this.myId=e,this.isPlayer=t,this.isPlayer||this.playIdle2(),t&&(this.changeSkin(-1!=a.freeSkinId?a.freeSkinId:a.getPlayerData().playerId),this.hp=a.getPlayerPowerData().hp,this.hpMax=this.hp,this.atk=a.getPlayerPowerData().atk)}playIdle1(){this._ani.speed=1,this._ani.crossFade("idle1",.05)}playIdle2(){this._ani.speed=1,this._ani.crossFade("idle2",.05)}playWalk(){this._ani.play("walk",0,0),this._ani.crossFade("hit",.05,1),this._ani.getControllerLayer(1).getAnimatorState("hit").speed=this.getPlayerAniSpeed()}playDied(){this._ani.crossFade("died",.05),this._ani.getControllerLayer(1).getAnimatorState("hit").speed=0}getPlayerAniSpeed(){let e=this.weaponLength;return e>50?this.weaponSpeed-this.weaponSpeed*(e-50)*.01:this.weaponSpeed}getHitbackDistance(){let e=this.weaponLength;return e>50?this.backDistance-this.backDistance*(e-50)*.01:this.backDistance}addWeapon(e){this.weaponNode.addChild(e),this.weaponLength=this.weaponNode.getChildAt(0).numChildren>100?100:this.weaponNode.getChildAt(0).numChildren,e.transform.localPosition=new Laya.Vector3(0,0,0),this.haveWeapon=!0,this.weaponNode.numChildren>30&&(this.atk=this.atk*(1+.005*(this.weaponNode.numChildren-30))),this.isPlayer&&o.instance.playSoundEffect("weaponReady.mp3"),this.playIdle2()}removeWeapon(){this.weaponNode.destroyChildren()}goToFight(e){this.isPlayer?(this.hp==this.hpMax&&(this.hp=a.getPlayerPowerData().hp,this.hpMax=this.hp),this.atk=a.getPlayerPowerData().atk):(this.hp==this.hpMax&&(this.hp=a.getNpcData().hp,this.hpMax=this.hp),this.atk=a.getNpcData().atk),this.fightStarted=!0,this.enemyNode=e,this.isBossState=a.getPlayerData().gradeIndex>=3,this.playWalk()}onUpdate(){if(this.enemyNode&&this.enemyNode.numChildren>0&&!this.isHited&&!this.isDied&&this.fightStarted&&!f.Share.pauseGame){let t=this.myOwner.transform.position.clone(),a=99999,i=null;for(let e=0;e<this.enemyNode.numChildren;e++){let s=this.enemyNode.getChildAt(e);if(!s||!s.transform)continue;let n=s.getComponent(B);if(n&&n.isDied)continue;let r=Laya.Vector3.distance(t,s.transform.position.clone());r<a&&(a=r,i=s)}if(this.closeNode&&this.closeNode.transform&&this.closeNode.getComponent(B)&&!this.closeNode.getComponent(B).isDied?i=this.closeNode:(this.closeNode=null,this.closeNode=i),!i)return;this.myOwner.transform.lookAt(i.transform.position,new Laya.Vector3(0,1,0)),this.myOwner.transform.rotate(new Laya.Vector3(0,180,0),!0,!1);let s=e.getDirectionAToB(this.myOwner,i);s=new Laya.Vector3(s.x*this.walkSpeed,s.y*this.walkSpeed,s.z*this.walkSpeed);let n=new Laya.Vector3(0,0,0);if(Laya.Vector3.add(t,s,n),this.isBossState&&a<6)return;if(!this.isBossState&&a<.5)return;this.myOwner.transform.position=n}}onLateUpdate(){this.weaponNode&&this.enemyNode&&this.enemyNode.numChildren>0&&!this.isHited&&!this.isDied&&this.fightStarted&&!f.Share.pauseGame&&this.checkIsHitEnemy()}checkIsHitEnemy(){let e=this.weaponNode.getChildAt(0);if(e&&null!=e&&null!=e&&!this.isDied)for(let t=0;t<e.numChildren;t++){let a=e.getChildAt(t),i=a.transform.position.clone();i.y=0;for(let e=0;e<this.enemyNode.numChildren;e++){let t=this.enemyNode.getChildAt(e),s=t.transform.position.clone();s.y=0;let n=Laya.Vector3.distance(i,s);if(!this.isBossState&&n<=1){return void t.getComponent(B).hitBack(a,this.atk,this.myOwner)}if(this.isBossState&&n<=5){return void t.getComponent(d).hitBack(this.atk)}}}}hitBack(t,i,s){if(this.isDied||this.isHited)return;this.isPlayer||c.DoVibrate();let n=e.GetRandom(1,4);if(o.instance.playSoundEffect("weaponHit"+n+".mp3"),this.createHitFX(),this.hp-=i,this.hp<=0){this.isPlayer?L.Share.createSmile(s):(L.Share.createCry(this.myOwner),L.Share.createCoinBoom(this.myOwner),a.changeCoin(10),o.instance.playSoundEffect("getCoin.mp3"));let t=e.GetRandom(1,2);return o.instance.playSoundEffect("die"+t+".mp3"),this.isDied=!0,this.playDied(),void Laya.timer.once(1e3,this,()=>{this.owner.destroy()})}this.isHited=!0;let r=t.transform.position.clone(),h=this.myOwner.transform.position.clone(),l=new Laya.Vector3(0,0,0);Laya.Vector3.subtract(h,r,l),Laya.Vector3.normalize(l,l),l=new Laya.Vector3(l.x*this.getHitbackDistance(),0,l.z*this.getHitbackDistance());let d=this.myOwner.transform.position.clone();Laya.Vector3.add(d,l,d),e.TmoveTo(this.myOwner,200,d,()=>{this.isHited=!1})}createHitFX(){let e=Laya.loader.getRes(c.UnityPath+"hitFX.lh"),t=Laya.Sprite3D.instantiate(e,this.myOwner,!0,new Laya.Vector3(0,2,0));t.transform.localPosition=new Laya.Vector3(0,1.5,0),Laya.timer.once(1e3,f.Share,()=>{t.destroy()})}changeSkin(e){let t=new Laya.UnlitMaterial;Laya.Texture2D.load("res/skinHero/HeroD_"+(e+1)+".png",Laya.Handler.create(this,function(e){t.albedoTexture=e}));for(let e=1;e<=4;e++){this.owner.getChildAt(e).skinnedMeshRenderer.material=t}this.embNode.destroyChildren();let a=Laya.loader.getRes(c.UnityPath+"Hero"+(e+1)+"_Emb.lh"),i=Laya.Sprite3D.instantiate(a,this.embNode,!1,new Laya.Vector3(0,0,0));i.transform.localScale=this.embScale,i.transform.localPosition=this.embPos,i.transform.localRotation=this.embRotation}}class f{constructor(){this.LINE_GAP=.1,this.PLAYER_GAP=3,this.GRADE_GAP=30,this._playerNode=new Laya.Sprite3D,this._aiNode=new Laya.Sprite3D,this.circleEffect=new Laya.Sprite3D,this.camStartPos=new Laya.Vector3(0,0,0),this.canTouch=!1,this.gameStarted=!1,this.canReady=!1,this.isHelpStart=!1,this.pauseGame=!1,this.gradeIndex=0,this.tempPlayerCount=0,this.isOver=!1,this.gotKillBossBounes=!1,this.isBanGameUIBanner=!1,this.showBottomBanner=!0,this.hadAutoShowUpgrade=!1,l.instance.initAd(),e.loadJson("res/config/aiConfig.json",e=>{a.aiConfig=e}),e.loadJson("res/config/posConfig.json",e=>{a.posConfig=e}),a.getPlayerData(),g.instance(),new y,a.getPlayerData().gradeIndex=0,this.gradeIndex=a.getPlayerData().gradeIndex,f.Share=this,c.WxOnHide(()=>{a.setExitTime(),localStorage.setItem("lastDate",(new Date).getDate().toString()),localStorage.setItem("front_share_number",c.front_share_number.toString())}),r.instance.initJJ(c.version,()=>{if(c.calculateShareNumber(),h.instance.initShare(),Laya.Scene.open("MyScenes/LoadingUI.scene"),Laya.Browser.onWeiXin)if(c.sceneId=c.GetLaunchPassVar().scene,console.log("sceneId:",c.sceneId),localStorage.getItem("WhiteList")){let e=localStorage.getItem("WhiteList");c.isWhiteList="1"==e}else c.isWhiteList=c.allowScene(),localStorage.setItem("WhiteList",c.isWhiteList?"1":"0")})}loadAtlas(){var e=[{url:"res/atlas/finishUI.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/finishUI.png",type:Laya.Loader.IMAGE},{url:"res/atlas/mainUI.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/mainUI.png",type:Laya.Loader.IMAGE},{url:"res/atlas/offlineUI.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/offlineUI.png",type:Laya.Loader.IMAGE},{url:"res/atlas/normalUI.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/normalUI.png",type:Laya.Loader.IMAGE},{url:"res/atlas/heroSkins.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/heroSkins.png",type:Laya.Loader.IMAGE},{url:"res/atlas/freeSkins.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/freeSkins.png",type:Laya.Loader.IMAGE},{url:"res/atlas/skinUI.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/skinUI.png",type:Laya.Loader.IMAGE},{url:"res/atlas/boxUI.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/boxUI.png",type:Laya.Loader.IMAGE},{url:"res/atlas/packetsUI.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/packetsUI.png",type:Laya.Loader.IMAGE}];Laya.loader.load(e,Laya.Handler.create(this,function(){Laya.Scene.open("MyScenes/LoadingUI.scene")}))}initScene(){Laya.Scene3D.load(c.UnityPath+"MyScene.ls",Laya.Handler.create(this,this.onLoadScene))}onLoadScene(e){this._scene=Laya.stage.addChild(e),Laya.stage.setChildIndex(this._scene,0),this._scene.addChild(this._playerNode),this._scene.addChild(this._aiNode),this._camera=this._scene.getChildByName("Main Camera"),this._light=this._scene.getChildByName("Directional Light"),this._plane=this._scene.getChildByName("Plane"),this.camStartPos=this._camera.transform.position.clone(),this.fixCameraField();let t=Laya.loader.getRes(c.UnityPath+"Circle_1.lh");this.circleEffect=Laya.Sprite3D.instantiate(t,this._scene,!0,new Laya.Vector3(0,.1,0)),this.circleEffect.active=!1,Laya.timer.frameLoop(1,this,this.updateCircle)}fixCameraField(){let e=(Laya.stage.displayHeight-1334<0?0:Laya.stage.displayHeight-1334)/290*10;this._camera.fieldOfView=70+e}moveCamera(t,a=2e3){let i=this._camera,s=i.transform.position.clone();s.z+=t,e.TmoveTo(i,a,s,()=>{})}createPlayer(){let e=Laya.loader.getRes(c.UnityPath+"Hero_1.lh"),t=(a.getPlayerCount()+this.tempPlayerCount-1)*this.PLAYER_GAP/2;for(let i=0;i<a.getPlayerCount()+this.tempPlayerCount;i++){let a=Laya.Sprite3D.instantiate(e,this._playerNode,!1,new Laya.Vector3(0,0,0));a.addComponent(B).initData(i,!0),a.transform.translate(new Laya.Vector3(t,0,this.GRADE_GAP*this.gradeIndex),!1),t-=this.PLAYER_GAP,L.Share.createHpBar(a)}}pushPlayer(){let e=Laya.loader.getRes(c.UnityPath+"Hero_1.lh"),t=(a.getPlayerCount()-1)*this.PLAYER_GAP/2;for(let i=0;i<a.getPlayerCount();i++){if(i+1<=this._playerNode.numChildren){t-=this.PLAYER_GAP;let e=this._playerNode.getChildAt(i).getComponent(B);e.hp=e.hpMax;continue}let a=Laya.Sprite3D.instantiate(e,this._playerNode,!1,new Laya.Vector3(0,0,0));a.addComponent(B).initData(i,!0),a.transform.translate(new Laya.Vector3(t,0,this.GRADE_GAP*this.gradeIndex),!1),t-=this.PLAYER_GAP,L.Share.createHpBar(a)}}updateCircle(){if(!this._playerNode||this._playerNode.numChildren<=0)this.circleEffect.active=!1;else{for(let e=0;e<this._playerNode.numChildren;e++){let t=this._playerNode.getChildAt(e);if(!t.getComponent(B).haveWeapon){let e=t.transform.position.clone(),a=new Laya.Vector3(e.x,.1,e.z+.1);return this.circleEffect.transform.position=a,void(this.circleEffect.active=!0)}}this.circleEffect.active=!1}}createAi(){if(a.getPlayerData().gradeIndex>=3)return void this.createBoss();let t=null,i=0,s=[],n=[],r=0;a.getPlayerData().grade>19?(s=a.posConfig.sort,i=e.GetRandom(0,9),n=e.getRandomItemInArr(s),r=e.GetRandom(1,7)):(i=(t=a.aiConfig["grade"+a.getPlayerData().grade]).skinId,n=(s=t.sort)[a.getPlayerData().gradeIndex]),this._aiNode.transform.position=new Laya.Vector3(0,0,10+this.GRADE_GAP*this.gradeIndex);let o=Laya.loader.getRes(c.UnityPath+"Hero_1.lh"),h=this.PLAYER_GAP;for(let e=0;e<n.length;e++){let t=Laya.Sprite3D.instantiate(o,this._aiNode,!0,new Laya.Vector3(0,0,0)),s=t.addComponent(B);s.initData(e,!1),s.changeSkin(i),t.transform.localPosition.x=n[e][0]*h,t.transform.localPosition.y=0,t.transform.localPosition.z=n[e][1]*h,t.transform.rotate(new Laya.Vector3(0,180,0),!0,!1),L.Share.createHpBar(t);let l=a.getPlayerData().grade>19?r:n[e][2]+1,d=Laya.loader.getRes(c.UnityPath+"Arms_"+l+".lh"),y=Laya.Sprite3D.instantiate(d,null,!0,new Laya.Vector3(0,0,0));s.addWeapon(y)}}createBoss(){this._aiNode.transform.position=new Laya.Vector3(0,0,10+this.GRADE_GAP*this.gradeIndex);let e=Laya.loader.getRes(c.UnityPath+"Hero_Boss.lh");e.getComponent(Laya.Animator).getControllerLayer().playOnWake=!1;let t=Laya.Sprite3D.instantiate(e,this._aiNode,!0,new Laya.Vector3(0,0,0));t.addComponent(d);t.transform.localPosition.x=0,t.transform.localPosition.y=0,t.transform.localPosition.z=0,t.transform.rotate(new Laya.Vector3(0,180,0),!0,!1)}createLine3D(e){let t=new Laya.Sprite3D,a=Laya.loader.getRes(c.UnityPath+"line.lh"),i=new Laya.Vector3(0,0,0);for(let s=0;s<e.length;s++)if(0==s){let e=Laya.Sprite3D.instantiate(a,t,!1,new Laya.Vector3(0,0,0));e.transform.position=new Laya.Vector3(0,0,0),i=e.transform.position.clone()}else{let n=new Laya.Vector3(-e[s-1].x,0,-e[s-1].y),r=new Laya.Vector3(-e[s].x,0,-e[s].y),o=t.getChildAt(t.numChildren-1).transform.position.clone(),h=Laya.Vector3.distance(n,r);for(let e=0;e<Math.floor(h/10);e++){let s=Laya.Sprite3D.instantiate(a,t,!1,new Laya.Vector3(0,0,0)),h=new Laya.Vector3(0,0,0);Laya.Vector3.subtract(r,n,h),Laya.Vector3.normalize(h,h);let l=this.LINE_GAP*(e+1);h=new Laya.Vector3(h.x*l,h.y*l,h.z*l);let c=new Laya.Vector3(0,0,0);Laya.Vector3.add(o,h,c),s.transform.position=c,s.transform.position.z<i.z&&(i=s.transform.position.clone())}}for(let e=0;e<t.numChildren;e++){let a=t.getChildAt(e),s=new Laya.Vector3(0,0,0);Laya.Vector3.subtract(a.transform.position,i,s),a.transform.position=s}for(let e=0;e<this._playerNode.numChildren;e++){let a=this._playerNode.getChildAt(e).getComponent(B);if(!a.haveWeapon){a.addWeapon(t);break}}this.checkWeaponed()&&this.readyGo()}checkWeaponed(){let e=!0;for(let t=0;t<this._playerNode.numChildren;t++){this._playerNode.getChildAt(t).getComponent(B).haveWeapon||(e=!1)}return e}readyGo(){if(a.getFreeSkins().length>0&&!this.canReady&&a.getPlayerData().grade>=r.instance.dataConfig.front_share_try&&0==a.getPlayerData().gradeIndex)Laya.Scene.open("MyScenes/FreeSkinUI.scene",!1);else{c.firstStartGame||(c.firstStartGame=!0,c.aldEvent("进入游戏后首次点击开始游戏")),0==a.getPlayerData().gradeIndex&&(c.aldEvent("开始游戏"),c.aldEvent("第"+a.getPlayerData().grade+"关：进入")),this.canTouch=!1,L.Share.visibleBottomUI(!1);for(let e=0;e<this._playerNode.numChildren;e++){this._playerNode.getChildAt(e).getComponent(B).goToFight(this._aiNode)}if(a.getPlayerData().gradeIndex<3)for(let e=0;e<this._aiNode.numChildren;e++){this._aiNode.getChildAt(e).getComponent(B).goToFight(this._playerNode)}Laya.timer.clear(this,this.checkIsOver),Laya.timer.frameLoop(1,this,this.checkIsOver)}}checkIsOver(){if(this._aiNode.numChildren<=0){if(this._playerNode.numChildren<=a.getPlayerCount()&&(this.tempPlayerCount=0),this.gradeIndex+=1,Laya.timer.clear(this,this.checkIsOver),this.gradeIndex>=4)return this.tempPlayerCount=0,c.tempGrade=a.getPlayerData().grade,a.getPlayerData().grade+=1,a.getPlayerData().gradeIndex=0,a.setPlayerData(),Laya.Scene.close("MyScenes/GameUI.scene"),Laya.Scene.open("MyScenes/KillBossUI.scene",!0,()=>{this._playerNode.active=!0,Laya.Scene.open("MyScenes/FinishUI.scene",!1)}),void(this._playerNode.active=!1);a.getPlayerData().gradeIndex=this.gradeIndex,a.setPlayerData(),p.Share.initData(),Laya.timer.once(200,this,()=>{this.moveCamera(this.GRADE_GAP,1800)});let t=(a.getPlayerCount()+this.tempPlayerCount-1)*this.PLAYER_GAP/2;for(let a=0;a<this._playerNode.numChildren;a++){let i=this._playerNode.getChildAt(a),s=i.getComponent(B);s.fightStarted=!1;let n=new Laya.Vector3(t-a*this.PLAYER_GAP,0,this.GRADE_GAP*this.gradeIndex);e.TmoveTo(i,2e3,n,()=>{s.playIdle2()}),e.RotateTo(i,1e3,new Laya.Vector3(0,0,0),()=>{})}this.createAi(),Laya.timer.once(2e3,this,()=>{this.checkIsNeedCreatePlayer()})}if(this._playerNode.numChildren<=0&&!this.isOver){this.isOver=!0,this.tempPlayerCount=0,Laya.Scene.close("MyScenes/GameUI.scene");let e=()=>{f.Share.isBanGameUIBanner=!0,f.Share._playerNode.active=!0,f.Share._aiNode.active=!0,Laya.Scene.open("MyScenes/GameUI.scene",!1,()=>{L.Share.visibleGameOverNode(!0)})};f.Share._playerNode.active=!1,f.Share._aiNode.active=!1,c.tempGrade=a.getPlayerData().grade,Laya.Scene.open("MyScenes/KillBossUI.scene",!1,()=>{e()})}}getIsOver(){if(this._playerNode.numChildren<=0)return!0;{let e=!0;for(let t=0;t<this._playerNode.numChildren;t++){if(!this._playerNode.getChildAt(t).getComponent(B).isDied){e=!1;break}}return e}}checkIsNeedCreatePlayer(){this._playerNode.numChildren<a.getPlayerCount()&&this.gradeIndex<3?(l.instance.hideBanner(),L.Share.reviveBtnCB()):(this.showBottomBanner=!1,this.readyGo())}revivePlayer(){this.canTouch=!0,this.pushPlayer()}goAhead(){this.readyGo()}upgradePlayerCount(){this._playerNode.destroyChildren(),this.createPlayer()}changePlayerSkin(e){for(let t=0;t<this._playerNode.numChildren;t++){let i=this._playerNode.getChildAt(t).getComponent(B);e?i.changeSkin(e):i.changeSkin(a.getPlayerData().playerId)}}checkCanUpgrade(){let e=a.getPlayerData().coin;!this.hadAutoShowUpgrade&&0==a.getPlayerData().gradeIndex&&(e>=a.getUpgradePlayerCountLvCost()||e>=a.getUpgradePlayerPowerLvCost()||e>=a.getUpgradeOfflineLvCost())&&(this.hadAutoShowUpgrade=!0,L.Share.upgradeBtnCB())}restartGame(){this.isOver=!1,f.Share.gotKillBossBounes=!1,this.gameStarted=!1,0==a.getPlayerData().gradeIndex&&(this._camera.transform.position=this.camStartPos,this.isHelpStart||(this.canReady=!1,-1!=a.freeSkinId&&(a.freeSkinId=-1))),this._aiNode.destroyChildren(),this._playerNode.destroyChildren(),this.createAi(),this.createPlayer(),L.Share.visibleBottomUI(!0),this.canTouch=!0,p.Share.initData(),this.checkCanUpgrade()}}f.WEAPON_LENGTH_MAX=100,f.WEAPON_LENGTH_MIN=10;class C extends Laya.Scene{constructor(){super(),this.backBtn=this.backBtn,this.coinNum=this.coinNum,this.skinIcon=this.skinIcon,this.boxNode=this.boxNode,this.keyNode=this.keyNode,this.videoBtn=this.videoBtn,this.keyNum=3,this.clickCount=0,this.skinId=-1,this.skinIndex=-1,this.gotBounes=!1}onOpened(e){this.backBtn.on(Laya.Event.CLICK,this,this.backBtnCB),this.videoBtn.on(Laya.Event.CLICK,this,this.videoBtnCB),this.initKey(),this.initCoin(),this.getBoxSkinId();for(let e=0;e<this.boxNode.numChildren;e++){let t=this.boxNode.getChildAt(e);t.on(Laya.Event.CLICK,this,this.itemCB,[e]),t.getChildByName("coinNode").visible=!1}}onClosed(){r.instance.dataConfig.front_box_ads&&l.instance.showAppBox()}getBoxSkinId(){let e=a.getBoxSkins();if(e.length<=0)return this.skinId=-1,void(this.skinIcon.skin="mainUI/sy-jb.png");this.skinIndex=Math.floor(Math.random()*e.length),this.skinId=e[this.skinIndex],-1==this.skinId?this.skinIcon.skin="mainUI/sy-jb.png":this.skinIcon.skin=a.getHeroSkinDir(this.skinId)}initKey(){for(let e=0;e<3;e++){this.keyNode.getChildAt(e).skin=e<this.keyNum?"boxUI/bx-ys1.png":"boxUI/bx-ys2.png"}}initCoin(){this.coinNum.value=a.getPlayerData().coin.toString()}itemCB(e){let t=this.boxNode.getChildAt(e),i=t.getChildByName("box"),s=t.getChildByName("coinNode"),n=s.getChildByName("coinNum");if("boxUI/bx-di2.png"==t.skin||this.keyNum<=0)return;t.skin="boxUI/bx-di2.png",this.keyNum--,this.clickCount++,this.initKey(),this.clickCount>=9?(this.keyNode.visible=!1,this.videoBtn.visible=!1):this.keyNum<=0&&(this.keyNode.visible=!1,this.videoBtn.visible=!0);let r=!1,h=5,l=100*Math.random();l<=20||(l<=35?h=10:l<=45?h=15:l<=55?h=20:l<=65?h=25:l<=75?h=30:l<=85?h=35:l<=95?h=50:-1==this.skinId||this.gotBounes?(r=!1,h=50):(this.gotBounes=!0,r=!0)),this.clickCount>=9&&-1!=this.skinId&&!this.gotBounes&&(this.gotBounes=!0,r=!0),r?(a.getPlayerSkin(a.skinArr3.indexOf(this.skinId)+18,this.skinId),i.visible=!0,i.skin=a.getHeroSkinDir(this.skinId),i.y=65):(o.instance.playSoundEffect("getCoin.mp3"),a.changeCoin(h),this.initCoin(),i.visible=!1,s.visible=!0,n.value=h.toString())}videoBtnCB(){c.aldEvent("增加三个钥匙：点击");h.instance.shareGame(()=>{c.aldEvent("增加三个钥匙：成功"),this.keyNum=3,this.videoBtn.visible=!1,this.keyNode.visible=!0,this.initKey()})}backBtnCB(){Laya.Scene.open("MyScenes/GameUI.scene",!0,()=>{f.Share.restartGame()})}}class w extends Laya.Script{constructor(){super(),this.shareIconStr="",this.videoIconStr="",this.myOwner=null}onAwake(){this.myOwner=this.owner}onDisable(){}onUpdate(){c.front_share_number>0?this.myOwner.skin=this.shareIconStr:this.myOwner.skin=this.videoIconStr}}class S extends Laya.Script{constructor(){super()}onAwake(){let e=this.owner;e.y=e.y*Laya.stage.displayHeight/1334}}class v extends Laya.Scene{constructor(){super(),this.openBoxBtn=this.openBoxBtn,this.videoBtn=this.videoBtn,this.noBtn=this.noBtn,this.bounes=this.bounes,this.moreGameBtn=this.moreGameBtn,this.boxBtnEnabled=!0}onOpened(e){c.aldEvent("第"+a.getPlayerData().grade+"关：通关"),this.initData(),l.instance.hideBanner(!1)}onClosed(){l.instance.hideBanner(),Laya.timer.clearAll(this)}initData(){this.openBoxBtn.on(Laya.Event.CLICK,this,this.openBoxCB),this.videoBtn.on(Laya.Event.CLICK,this,this.videoBtnCB),this.noBtn.on(Laya.Event.CLICK,this,this.noBtnCB),this.moreGameBtn.on(Laya.Event.CLICK,this,this.moreGameBtnCB),e.rotateLoop(this.moreGameBtn.getChildAt(0),15,100);let t=a.getPlayerData().grade-1,i=0==Math.floor(t%4)?4:Math.floor(t%4);if(this.bounes.skin=4==i?"finishUI/js-bx.png":"finishUI/js-ys.png",this.openBoxBtn.visible=4==i,this.videoBtn.visible=4!=i,this.noBtn.visible=4!=i,r.instance.dataConfig.front_box_ads?(this.btnNode.visible=!1,l.instance.showAppBox(()=>{this.closeAppCB()}),Laya.timer.once(7e3,this,this.closeAppCB)):this.noBtn.visible?c.fixBtnTouchPos(this.noBtn,320,100,this):(this.boxBtnEnabled=!1,c.fixBtnTouchPos(this.openBoxBtn,320,0,this,()=>{this.boxBtnEnabled=!0})),f.Share.isHelpStart=!1,f.Share.gradeIndex=0,a.getPlayerData().gradeIndex=0,a.setPlayerData(),this.bounesCoin.visible=f.Share.gotKillBossBounes,f.Share.gotKillBossBounes){f.Share.gotKillBossBounes=!1;let t=e.GetRandom(30,100);this.bounesCoin.text="成功领取"+t+"金币",e.tMove2D(this.bounesCoin,this.bounesCoin.x,this.bounesCoin.y-100,2e3,()=>{this.bounesCoin.visible=!1}),a.changeCoin(t)}}closeAppCB(){let e=this;l.instance.closeAppBox(),Laya.timer.clearAll(this),e.btnNode.visible=!0,e.noBtn.visible?c.fixBtnTouchPos(e.noBtn,320,100,e):(e.boxBtnEnabled=!1,c.fixBtnTouchPos(e.openBoxBtn,320,0,e,()=>{e.boxBtnEnabled=!0}))}moreGameBtnCB(){l.instance.showAppBox()}openBoxCB(){this.boxBtnEnabled&&Laya.Scene.open("MyScenes/BoxUI.scene")}videoBtnCB(){c.aldEvent("视频/分享打开宝箱：点击");h.instance.shareGame(()=>{c.aldEvent("视频/分享打开宝箱：成功"),Laya.Scene.open("MyScenes/BoxUI.scene")})}noBtnCB(){this.close(),Laya.Scene.open("MyScenes/GameUI.scene",!1,()=>{f.Share.restartGame(),r.instance.dataConfig.front_box_ads&&l.instance.showAppBox()})}}class b extends Laya.Scene{constructor(){super(),this.closeBtn=this.closeBtn,this.itemNode=this.itemNode,this.randBtn=this.randBtn,this.skinArr=[]}onOpened(e){this.closeBtn.on(Laya.Event.CLICK,this,this.closeBtnCB),this.randBtn.on(Laya.Event.CLICK,this,this.randBtnCB),this.skinArr=a.getFreeSkins(),this.initData(),c.fixBtnTouchPos(this.closeBtn,770,540,this)}onClosed(){l.instance.hideBanner()}initData(){for(let e=0;e<4;e++){let t=this.itemNode.getChildAt(e);if(e>=this.skinArr.length){t.visible=!1;continue}t.getChildByName("icon").skin="freeSkins/HeroD_"+(this.skinArr[e]+1)+".png";let a=this.skinArr[e];t.off(Laya.Event.CLICK,this,this.itemCB),t.on(Laya.Event.CLICK,this,this.itemCB,[a])}}itemCB(e){c.aldEvent("试用皮肤：点击");h.instance.shareGame(()=>{c.aldEvent("试用皮肤：成功"),a.freeSkinId=e,f.Share.changePlayerSkin(e),this.closeBtnCB()})}randBtnCB(){let t=e.getRandomItemInArr(this.skinArr);this.itemCB(t)}closeBtnCB(){this.close(),f.Share.canReady=!0,f.Share.readyGo()}}class P extends Laya.Scene{constructor(){super(),this.closeBtn=this.closeBtn,this.barNode=this.barNode,this.clickBtn=this.clickBtn,this.atkAni=this.atkAni,this.clickBossBtn=this.clickBossBtn,this.isBannerType=!0,this.curProgress=0,this.closeCallback=null,this.hadShowBanner=!1,this.canShowBox=!0}onOpened(t){null!=t&&null!=t&&(this.closeCallback=t),this.atkAni.loop=!1,100*Math.random()<=r.instance.dataConfig.front_banner_probability?(this.isBannerType=!0,this.clickBtn.visible=!0,this.clickBossBtn.visible=!1):(this.isBannerType=!1,this.clickBtn.visible=!1,this.clickBossBtn.visible=!0),this.closeBtn.on(Laya.Event.CLICK,this,this.closeBtnCB),this.clickBtn.on(Laya.Event.MOUSE_DOWN,this,this.clickBtnCBDown),this.clickBtn.on(Laya.Event.MOUSE_UP,this,this.clickBtnCBUp),this.clickBossBtn.on(Laya.Event.MOUSE_DOWN,this,this.clickBossBtnCB),e.visibleDelay(this.closeBtn,3e3),Laya.timer.frameLoop(1,this,this.decBar),c.isKillBossUI=!0,c.WxOnHide(()=>{c.isKillBossUI&&Laya.timer.once(100,this,()=>{Laya.Scene.close("MyScenes/KillBossUI.scene")})}),l.instance.hideBanner(),Laya.timer.once(5e3,this,()=>{this.close()}),Laya.timer.once(4e3,this,()=>{this.canShowBox=!1,l.instance.closeAppBox()})}onClosed(){l.instance.closeAppBox(),Laya.timer.clearAll(this),this.closeCallback&&this.closeCallback(),c.isKillBossUI=!1}decBar(){this.curProgress>=1?Laya.timer.clear(this,this.decBar):(this.curProgress-=.005,this.curProgress<0&&(this.curProgress=0),this.barNode.value=this.curProgress)}clickBtnCBDown(){f.Share.gotKillBossBounes=!0;let e=c.tempGrade,t=(e-r.instance.dataConfig.front_box_gate)%r.instance.dataConfig.front_box_everygate==0&&e-r.instance.dataConfig.front_box_gate>=0;if(!this.hadShowBanner&&e>=r.instance.dataConfig.front_box_gate&&t&&c.isValidBanner()&&r.instance.dataConfig.front_box_page&&(this.hadShowBanner=!0,Laya.timer.once(1e3,this,()=>{l.instance.showBanner()})),this.atkAni.play(0,!1),this.clickBtn.scaleX=1.2,this.clickBtn.scaleY=1.2,this.curProgress+=.15,this.curProgress>1)return this.curProgress=1,this.barNode.value=1,void this.close();this.createCoin(),this.createCoin(),this.createCoin(),this.createCoin(),this.createCoin()}clickBtnCBUp(){this.clickBtn.scaleX=1,this.clickBtn.scaleY=1}clickBossBtnCB(){f.Share.gotKillBossBounes=!0;let e=c.tempGrade,t=(e-r.instance.dataConfig.front_box_gate)%r.instance.dataConfig.front_box_everygate==0&&e-r.instance.dataConfig.front_box_gate>=0;if(!this.hadShowBanner&&e>=r.instance.dataConfig.front_box_gate&&t&&c.isValidBanner()&&this.canShowBox&&r.instance.dataConfig.front_box_page&&(this.hadShowBanner=!0,Laya.timer.once(1e3,this,()=>{l.instance.showAppBox()})),this.curProgress+=.15,this.curProgress>1)return this.curProgress=1,this.barNode.value=1,void this.close();this.createCoin(),this.createCoin(),this.createCoin(),this.createCoin(),this.createCoin()}closeBtnCB(){this.close()}createCoin(){let e=g.instance().getItem(n.Coin);this.addChild(e),e.pos(375,500);let t=new Laya.Vector2(400*Math.random()-200,400*Math.random()-200);Laya.Tween.to(e,{x:t.x+375,y:t.y+500},200),Laya.timer.once(1e3,this,()=>{e.destroy()})}}class I extends Laya.Scene{constructor(){super(),this.perNum=this.perNum,this.bar=this.bar}onOpened(e){o.instance.initLoading(()=>{this.loadRes()}),c.aldEvent("加载页面")}onClosed(){}loadSubpackage(){Laya.Browser.window.qq.loadSubpackage({name:"unity",success:e=>{this.loadRes()},fail:e=>{this.loadSubpackage()}}).onProgressUpdate(e=>{console.log("下载进度",e.progress),console.log("已经下载的数据长度",e.totalBytesWritten),console.log("预期需要下载的数据总长度",e.totalBytesExpectedToWrite),this.perNum.text=Math.floor(e.progress/2)+"%",this.bar.width=e.progress/50*560})}loadRes(){var e=[c.UnityPath+"line.lh",c.UnityPath+"Hero_1.lh",c.UnityPath+"Hero_Boss.lh",c.UnityPath+"Circle_1.lh",c.UnityPath+"hitFX.lh"];for(let t=0;t<7;t++)e.push(c.UnityPath+"Arms_"+(t+1)+".lh");for(let t=0;t<10;t++)e.push(c.UnityPath+"Hero"+(t+1)+"_Emb.lh");Laya.loader.create(e,Laya.Handler.create(this,this.onComplete),Laya.Handler.create(this,this.onProgress))}onComplete(){this.loadAtlas(()=>{f.Share.initScene(),Laya.timer.once(1e3,this,()=>{Laya.Scene.open("MyScenes/GameUI.scene",!0,()=>{f.Share.createPlayer(),f.Share.createAi()}),c.aldEvent("进入首页")})})}onProgress(e){this.perNum.text=50+Math.floor(50*e)+"%",this.bar.width=280+560*e/2}loadAtlas(e){var t=[{url:"res/atlas/finishUI.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/finishUI.png",type:Laya.Loader.IMAGE},{url:"res/atlas/mainUI.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/mainUI.png",type:Laya.Loader.IMAGE},{url:"res/atlas/offlineUI.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/offlineUI.png",type:Laya.Loader.IMAGE},{url:"res/atlas/normalUI.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/normalUI.png",type:Laya.Loader.IMAGE},{url:"res/atlas/heroSkins.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/heroSkins.png",type:Laya.Loader.IMAGE},{url:"res/atlas/freeSkins.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/freeSkins.png",type:Laya.Loader.IMAGE},{url:"res/atlas/skinUI.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/skinUI.png",type:Laya.Loader.IMAGE},{url:"res/atlas/boxUI.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/boxUI.png",type:Laya.Loader.IMAGE}];Laya.loader.load(t,Laya.Handler.create(this,e))}}class A extends Laya.Scene{constructor(){super(),this.coinNum=this.coinNum,this.noBtn=this.noBtn,this.trippleBtn=this.trippleBtn,this.toggleBtn=this.toggleBtn,this.point=this.point,this.exTimeMin=0,this.bounesNum=0,this.bounesNumTriple=0,this.isTripple=!0,this.updateCompleted=!0}onOpened(e){c.isShowAppBox=!1,this.toggleBtn.on(Laya.Event.CLICK,this,this.trippleBtnCB),this.trippleBtn.on(Laya.Event.CLICK,this,this.getBounesCB),this.noBtn.on(Laya.Event.CLICK,this,this.getBounesCB),this.exTimeMin=e,this.bounesNum=a.getPlayerOffline(this.exTimeMin),this.bounesNumTriple=3*this.bounesNum,this.initData(),l.instance.showBanner()}onClosed(){l.instance.hideBanner(),localStorage.getItem("lastDate")&&!c.isShowAppBox&&r.instance.dataConfig.front_box_ads&&(c.isShowAppBox=!0,l.instance.showAppBox())}initData(){this.coinNum.value=this.bounesNumTriple.toString(),this.changePoint(),this.changeBtn()}trippleBtnCB(){this.updateCompleted&&(this.updateCompleted=!1,this.isTripple=!this.isTripple,this.changePoint(),this.changeBtn(),e.updateNumber(this.bounesNum,3,this.coinNum,!1,this.isTripple,()=>{this.updateCompleted=!0}))}getBounesCB(){let e=()=>{this.isTripple&&c.aldEvent("离线收益三倍：成功"),a.changeCoin(this.isTripple?this.bounesNumTriple:this.bounesNum),p.Share.initData(),this.close()};this.isTripple?(c.aldEvent("离线收益三倍：点击"),h.instance.shareGame(e)):e()}changePoint(){this.point.skin=this.isTripple?"offlineUI/lx-yuan.png":"offlineUI/lx-yuan2.png"}changeBtn(){this.noBtn.visible=!this.isTripple,this.trippleBtn.visible=this.isTripple}}class _ extends Laya.Script{constructor(){super(),this.myOwner=null,this._ani=null,this.weaponNode=null,this.embNode=null,this.embScale=null,this.embPos=null,this.embRotation=null}onAwake(){this.myOwner=this.owner,this._ani=this.owner.getComponent(Laya.Animator),this.playIdle1(),this.weaponNode=e.findNodeByName(this.myOwner,"Dummy_Arms"),this.embNode=e.findNodeByName(this.myOwner,"Dummy_Emb");let t=e.findNodeByName(this.myOwner,"Hero1_Emb");this.embScale=t.transform.localScale.clone(),this.embPos=t.transform.localPosition.clone(),this.embRotation=t.transform.localRotation.clone(),this.changeSkin(a.getPlayerData().playerId)}onDisable(){}playIdle1(){this._ani.crossFade("walk",.05),this._ani.crossFade("hit",.05,1)}changeSkin(e){let t=new Laya.UnlitMaterial;Laya.Texture2D.load("res/skinHero/HeroD_"+(e+1)+".png",Laya.Handler.create(this,function(e){t.albedoTexture=e}));for(let e=1;e<=4;e++){this.owner.getChildAt(e).skinnedMeshRenderer.material=t}this.embNode.destroyChildren();let a=Laya.loader.getRes(c.UnityPath+"Hero"+(e+1)+"_Emb.lh"),i=Laya.Sprite3D.instantiate(a,this.embNode,!1,new Laya.Vector3(0,0,0));i.transform.localScale=this.embScale,i.transform.localPosition=this.embPos,i.transform.localRotation=this.embRotation}}class N extends Laya.Scene{constructor(){super(),this.topBar=this.topBar,this.backBtn=this.backBtn,this.coinNum=this.coinNum,this.typePic=this.typePic,this.itemNode=this.itemNode,this.leftBtn=this.leftBtn,this.rightBtn=this.rightBtn,this.pointNode=this.pointNode,this.btn1=this.btn1,this.btn2=this.btn2,this.btn3=this.btn3,this.pageIndex=0,this.scene3D=null,this.light=null,this.camera=null,this.role=null,this.roleCrl=null}onOpened(e){this.backBtn.on(Laya.Event.CLICK,this,this.backBtnCB),this.leftBtn.on(Laya.Event.CLICK,this,this.turnPageCB,[!0]),this.rightBtn.on(Laya.Event.CLICK,this,this.turnPageCB,[!1]),this.leftBtn.visible=!1,this.btn1.on(Laya.Event.CLICK,this,this.btnCB1),this.btn2.on(Laya.Event.CLICK,this,this.btnCB2),this.updateCoinNum(),this.initData(),this.init3DScene()}onClosed(){}init3DScene(){this.scene3D=Laya.stage.addChild(new Laya.Scene3D),this.light=this.scene3D.addChild(new Laya.DirectionLight),this.light.color=new Laya.Vector3(1,.956,.839),this.light.transform.rotate(new Laya.Vector3(59.3,-55.16,0),!0,!1),this.camera=this.scene3D.addChild(new Laya.Camera(0,.1,100)),this.camera.transform.translate(new Laya.Vector3(0,2,7)),this.camera.transform.rotate(new Laya.Vector3(-10,0,0),!0,!1),this.camera.clearFlag=Laya.BaseCamera.CLEARFLAG_DEPTHONLY,this.fixCameraField();let e=Laya.loader.getRes(c.UnityPath+"Hero_1.lh");this.role=Laya.Sprite3D.instantiate(e,this.scene3D,!1,new Laya.Vector3(0,0,0)),this.role.transform.position=new Laya.Vector3(0,2.6,0),this.role.transform.rotationEuler=new Laya.Vector3(0,0,0),this.role.transform.setWorldLossyScale(new Laya.Vector3(.5,.5,.5)),this.roleCrl=this.role.addComponent(_)}fixCameraField(){let e=(Laya.stage.displayHeight-1334<0?0:Laya.stage.displayHeight-1334)/290*10;this.camera.fieldOfView+=e}initData(){this.typePic.skin="skinUI/pf-an"+(this.pageIndex+1)+".png";for(let e=0;e<this.pointNode.numChildren;e++){this.pointNode.getChildAt(e).skin=e==this.pageIndex?"skinUI/pf-yuan2.png":"skinUI/pf-yuan1.png"}this.btn1.getChildAt(0).text=a.getUnlockSkinCost().toString(),this.btn1.visible=0==this.pageIndex,this.btn2.visible=1==this.pageIndex,this.btn3.visible=2==this.pageIndex,this.initItem()}initItem(){for(let e=0;e<this.itemNode.numChildren;e++){let t=this.itemNode.getChildAt(e),i=t.getChildByName("icon"),s=t.getChildByName("tick");t.off(Laya.Event.CLICK,this,this.itemCB);let n=e+9*this.pageIndex,r=a.getPlayerData().playerArr[n]>=0,o=a.skinArr1;switch(this.pageIndex){case 0:o=a.skinArr1;break;case 1:o=a.skinArr2;break;case 2:o=a.skinArr3}e+1<=o.length?(i.visible=r,t.skin=r?"skinUI/pf-di2.png":"skinUI/pf-di.png",r&&(i.skin="heroSkins/Hero_"+(o[e]+1)+".png",t.on(Laya.Event.CLICK,this,this.itemCB,[n])),s.visible=r&&a.getPlayerData().playerId==o[e]):(s.visible=!1,i.visible=!1,t.skin="skinUI/pf-di.png")}}itemCB(e){a.getPlayerData().playerId=a.getPlayerData().playerArr[e],this.roleCrl.changeSkin(a.getPlayerData().playerId),f.Share.changePlayerSkin(),this.initData()}updateCoinNum(){this.coinNum.value=a.getPlayerData().coin.toString(),p.Share.initData()}turnPageCB(e){e?this.pageIndex--:this.pageIndex++,this.leftBtn.visible=this.pageIndex>0,this.rightBtn.visible=this.pageIndex<2,this.initData()}btnCB1(){let t=[].concat(a.getCoinSkins());if(t.length<=0)return void c.OpenAlert("敬请期待！");c.aldEvent("皮肤界面：金币解锁");let i=a.getUnlockSkinCost();if(i>a.getPlayerData().coin)return void c.OpenAlert("金币不足！");c.aldEvent("皮肤界面：金币解锁成功"),a.getPlayerData().unlockSkinCount++,a.changeCoin(-i),this.updateCoinNum();let s=e.getRandomItemInArr(t),n=a.skinArr1.indexOf(s);a.getPlayerSkin(n,s),this.roleCrl.changeSkin(a.getPlayerData().playerId),f.Share.changePlayerSkin(),this.initData()}btnCB2(){let t=[].concat(a.getVideoSkins());if(console.log(t),t.length<=0)return void c.OpenAlert("敬请期待！");c.aldEvent("皮肤界面：视频/分享解锁");h.instance.shareGame(()=>{c.aldEvent("皮肤界面：视频/分享解锁成功");let i=e.getRandomItemInArr(t),s=a.skinArr2.indexOf(i)+9;a.getPlayerSkin(s,i),this.roleCrl.changeSkin(a.getPlayerData().playerId),f.Share.changePlayerSkin(),this.initData()})}backBtnCB(){this.scene3D.destroy(),this.close()}}class k{constructor(){}static init(){var e=Laya.ClassUtils.regClass;e("View/BoxUI.ts",C),e("Libs/FixAdShareIcon.ts",w),e("Libs/FixNodeY.ts",S),e("View/FinishUI.ts",v),e("View/FreeSkinUI.ts",b),e("View/GameUI.ts",L),e("View/GameTopNode.ts",p),e("View/KillBossUI.ts",P),e("View/LoadingUI.ts",I),e("View/OfflineUI.ts",A),e("View/SkinUI.ts",N),e("Crl/FixAiTips.ts",m)}}k.width=750,k.height=1334,k.scaleMode="fixedwidth",k.screenMode="vertical",k.alignV="middle",k.alignH="center",k.startScene="MyScenes/LoadingUI.scene",k.sceneRoot="",k.debug=!1,k.stat=!1,k.physicsDebug=!1,k.exportSceneToJson=!0,k.init();new class{constructor(){window.Laya3D?Laya3D.init(k.width,k.height):Laya.init(k.width,k.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=k.scaleMode,Laya.stage.screenMode=k.screenMode,Laya.stage.alignV=k.alignV,Laya.stage.alignH=k.alignH,Laya.URL.exportSceneToJson=k.exportSceneToJson,(k.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),k.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),k.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){new f}}}();