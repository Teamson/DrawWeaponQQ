{
  "code": "import PlayerDataMgr from \"../Libs/PlayerDataMgr\";\r\nimport GameLogic from \"../Crl/GameLogic\";\r\nimport ShareMgr from \"../Mod/ShareMgr\";\r\nimport WxApi from \"../Libs/WxApi\";\r\nimport JJMgr from \"../JJExport/Common/JJMgr\";\r\nimport AdMgr from \"../Mod/AdMgr\";\r\nimport Utility from \"../Mod/Utility\";\r\nexport default class FinishUI extends Laya.Scene {\r\n    constructor() {\r\n        super();\r\n        this.openBoxBtn = this['openBoxBtn'];\r\n        this.videoBtn = this['videoBtn'];\r\n        this.noBtn = this['noBtn'];\r\n        this.bounes = this['bounes'];\r\n        this.moreGameBtn = this['moreGameBtn'];\r\n        this.boxBtnEnabled = true;\r\n        this.blockAdArr = [];\r\n        this.adPos = new Laya.Vector2(160, 310);\r\n        this.adIdArr = ['605606b335137a60a88b8d2647939ab7', 'a6e4c78b4a6454dcb5036115cd2291ca', 'c3cb50a04266e96455c97f980bf0d019'];\r\n        this.adIndex = 0;\r\n    }\r\n    onOpened(param) {\r\n        WxApi.aldEvent('第' + PlayerDataMgr.getPlayerData().grade + '关：通关');\r\n        this.initData();\r\n        AdMgr.instance.hideBanner(false);\r\n        if (JJMgr.instance.dataConfig.front_box_ads) {\r\n            AdMgr.instance.showAppBox();\r\n        }\r\n    }\r\n    onClosed() {\r\n        AdMgr.instance.hideBanner();\r\n        this.destroyAdArr();\r\n    }\r\n    initData() {\r\n        this.openBoxBtn.on(Laya.Event.CLICK, this, this.openBoxCB);\r\n        this.videoBtn.on(Laya.Event.CLICK, this, this.videoBtnCB);\r\n        this.noBtn.on(Laya.Event.CLICK, this, this.noBtnCB);\r\n        this.moreGameBtn.on(Laya.Event.CLICK, this, this.moreGameBtnCB);\r\n        Utility.rotateLoop(this.moreGameBtn.getChildAt(0), 15, 100);\r\n        let grade = PlayerDataMgr.getPlayerData().grade - 1;\r\n        let g = Math.floor(grade % 4) == 0 ? 4 : Math.floor(grade % 4);\r\n        this.bounes.skin = g == 4 ? 'finishUI/js-bx.png' : 'finishUI/js-ys.png';\r\n        this.openBoxBtn.visible = g == 4;\r\n        this.videoBtn.visible = g != 4;\r\n        this.noBtn.visible = g != 4;\r\n        if (this.noBtn.visible)\r\n            WxApi.fixBtnTouchPos(this.noBtn, 320, 100, this);\r\n        else {\r\n            this.boxBtnEnabled = false;\r\n            WxApi.fixBtnTouchPos(this.openBoxBtn, 320, 0, this, () => { this.boxBtnEnabled = true; });\r\n        }\r\n        GameLogic.Share.isHelpStart = false;\r\n        GameLogic.Share.gradeIndex = 0;\r\n        PlayerDataMgr.getPlayerData().gradeIndex = 0;\r\n        PlayerDataMgr.setPlayerData();\r\n        this['bounesCoin'].visible = GameLogic.Share.gotKillBossBounes;\r\n        if (GameLogic.Share.gotKillBossBounes) {\r\n            GameLogic.Share.gotKillBossBounes = false;\r\n            let c = Utility.GetRandom(30, 100);\r\n            this['bounesCoin'].text = '成功领取' + c + '金币';\r\n            Utility.tMove2D(this['bounesCoin'], this['bounesCoin'].x, this['bounesCoin'].y - 100, 2000, () => { this['bounesCoin'].visible = false; });\r\n            PlayerDataMgr.changeCoin(c);\r\n        }\r\n    }\r\n    moreGameBtnCB() {\r\n        AdMgr.instance.showAppBox();\r\n    }\r\n    openBoxCB() {\r\n        if (!this.boxBtnEnabled)\r\n            return;\r\n        Laya.Scene.open('MyScenes/BoxUI.scene');\r\n    }\r\n    videoBtnCB() {\r\n        WxApi.aldEvent('视频/分享打开宝箱：点击');\r\n        let cb = () => {\r\n            WxApi.aldEvent('视频/分享打开宝箱：成功');\r\n            Laya.Scene.open('MyScenes/BoxUI.scene');\r\n        };\r\n        ShareMgr.instance.shareGame(cb);\r\n    }\r\n    noBtnCB() {\r\n        this.close();\r\n        Laya.Scene.open('MyScenes/GameUI.scene', false, () => {\r\n            GameLogic.Share.restartGame();\r\n            if (JJMgr.instance.dataConfig.front_box_ads)\r\n                AdMgr.instance.showAppBox(true);\r\n        });\r\n    }\r\n    createBAD() {\r\n        if (Laya.Browser.onWeiXin) {\r\n            let pos = this.adPos.clone();\r\n            let height = 0;\r\n            if (Laya.Browser.pixelRatio > 2) {\r\n                height = pos.y * Laya.Browser.height / Laya.stage.displayHeight;\r\n            }\r\n            else {\r\n                height = pos.y * Laya.Browser.clientHeight / Laya.stage.displayHeight;\r\n            }\r\n            let ad = Laya.Browser.window.qq.createBlockAd({\r\n                adUnitId: this.adIdArr[this.adIndex],\r\n                style: {\r\n                    left: 100,\r\n                    top: height\r\n                },\r\n                size: 4,\r\n                orientation: 'landscape'\r\n            });\r\n            ad.onLoad((res) => {\r\n                if (this.adIndex + 1 <= 2) {\r\n                    this.adIndex++;\r\n                    this.createBAD();\r\n                }\r\n            });\r\n            ad.show();\r\n            ad.onError((res) => {\r\n                console.log('finishUI:', res);\r\n            });\r\n            ad.onResize((res) => {\r\n                let width = 0;\r\n                let height = 0;\r\n                if (Laya.Browser.pixelRatio > 2) {\r\n                    width = Laya.Browser.width / 2 - res.width / 2;\r\n                    height = pos.y * Laya.Browser.height / Laya.stage.displayHeight;\r\n                }\r\n                else {\r\n                    width = Laya.Browser.clientWidth / 2 - res.width / 2;\r\n                    height = pos.y * Laya.Browser.clientHeight / Laya.stage.displayHeight;\r\n                }\r\n                ad.style.left = width;\r\n                ad.style.top = height;\r\n            });\r\n            this.blockAdArr.push(ad);\r\n            this.adPos.y += 180;\r\n        }\r\n    }\r\n    destroyAdArr() {\r\n        for (let i = this.blockAdArr.length - 1; i >= 0; i--) {\r\n            this.blockAdArr[i].destroy();\r\n        }\r\n    }\r\n}\r\n",
  "references": [
    "E:/GitProjects/DrawWeaponQQ/src/Libs/PlayerDataMgr.ts",
    "E:/GitProjects/DrawWeaponQQ/src/Crl/GameLogic.ts",
    "E:/GitProjects/DrawWeaponQQ/src/Mod/ShareMgr.ts",
    "E:/GitProjects/DrawWeaponQQ/src/Libs/WxApi.ts",
    "E:/GitProjects/DrawWeaponQQ/src/JJExport/Common/JJMgr.ts",
    "E:/GitProjects/DrawWeaponQQ/src/Mod/AdMgr.ts",
    "E:/GitProjects/DrawWeaponQQ/src/Mod/Utility.ts"
  ]
}
