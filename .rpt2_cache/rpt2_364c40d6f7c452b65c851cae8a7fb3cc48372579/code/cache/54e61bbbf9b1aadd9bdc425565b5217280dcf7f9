{
  "code": "import AdMgr from \"../Mod/AdMgr\";\r\nimport PrefabManager, { PrefabItem } from \"../Libs/PrefabManager\";\r\nimport WxApi from \"../Libs/WxApi\";\r\nimport JJMgr from \"../JJExport/Common/JJMgr\";\r\nimport Utility from \"../Mod/Utility\";\r\nimport GameLogic from \"../Crl/GameLogic\";\r\nexport default class KillBossUI extends Laya.Scene {\r\n    constructor() {\r\n        super();\r\n        this.closeBtn = this['closeBtn'];\r\n        this.barNode = this['barNode'];\r\n        this.clickBtn = this['clickBtn'];\r\n        this.atkAni = this['atkAni'];\r\n        this.clickBossBtn = this['clickBossBtn'];\r\n        this.isBannerType = true;\r\n        this.curProgress = 0;\r\n        this.closeCallback = null;\r\n        this.hadShowBanner = false;\r\n        this.canShowBox = true;\r\n    }\r\n    onOpened(param) {\r\n        if (param != null && param != undefined) {\r\n            this.closeCallback = param;\r\n        }\r\n        this.atkAni.loop = false;\r\n        let randNum = Math.random() * 100;\r\n        if (randNum <= JJMgr.instance.dataConfig.front_banner_probability) {\r\n            this.isBannerType = true;\r\n            this.clickBtn.visible = true;\r\n            this.clickBossBtn.visible = false;\r\n        }\r\n        else {\r\n            this.isBannerType = false;\r\n            this.clickBtn.visible = false;\r\n            this.clickBossBtn.visible = true;\r\n        }\r\n        this.closeBtn.on(Laya.Event.CLICK, this, this.closeBtnCB);\r\n        this.clickBtn.on(Laya.Event.MOUSE_DOWN, this, this.clickBtnCBDown);\r\n        this.clickBtn.on(Laya.Event.MOUSE_UP, this, this.clickBtnCBUp);\r\n        this.clickBossBtn.on(Laya.Event.MOUSE_DOWN, this, this.clickBossBtnCB);\r\n        Utility.visibleDelay(this.closeBtn, 3000);\r\n        Laya.timer.frameLoop(1, this, this.decBar);\r\n        WxApi.isKillBossUI = true;\r\n        Laya.Browser.window.wx.onShow(() => {\r\n            if (this)\r\n                Laya.timer.clearAll(this);\r\n            if (WxApi.isKillBossUI) {\r\n                Laya.Scene.close('MyScenes/KillBossUI.scene');\r\n            }\r\n        });\r\n        AdMgr.instance.hideBanner();\r\n        Laya.timer.once(5000, this, () => {\r\n            this.close();\r\n        });\r\n        Laya.timer.once(4000, this, () => {\r\n            this.canShowBox = false;\r\n            AdMgr.instance.closeAppBox();\r\n        });\r\n    }\r\n    onClosed() {\r\n        WxApi.isKillBossUI = false;\r\n        AdMgr.instance.closeAppBox();\r\n        Laya.timer.clearAll(this);\r\n        this.closeCallback && this.closeCallback();\r\n    }\r\n    decBar() {\r\n        if (this.curProgress >= 1) {\r\n            Laya.timer.clear(this, this.decBar);\r\n            return;\r\n        }\r\n        this.curProgress -= 0.005;\r\n        if (this.curProgress < 0) {\r\n            this.curProgress = 0;\r\n        }\r\n        this.barNode.value = this.curProgress;\r\n    }\r\n    clickBtnCBDown() {\r\n        GameLogic.Share.gotKillBossBounes = true;\r\n        let curG = WxApi.tempGrade;\r\n        let gGap = (curG - JJMgr.instance.dataConfig.front_box_gate) % JJMgr.instance.dataConfig.front_box_everygate == 0 &&\r\n            curG >= JJMgr.instance.dataConfig.front_box_gate;\r\n        if (!this.hadShowBanner && gGap && WxApi.isWhiteList && JJMgr.instance.dataConfig.is_allow_area == 1) {\r\n            this.hadShowBanner = true;\r\n            Laya.timer.once(500, this, () => {\r\n                AdMgr.instance.showBanner();\r\n            });\r\n        }\r\n        this.atkAni.play(0, false);\r\n        this.clickBtn.scaleX = 1.2;\r\n        this.clickBtn.scaleY = 1.2;\r\n        this.curProgress += 0.15;\r\n        if (this.curProgress > 1) {\r\n            this.curProgress = 1;\r\n            this.barNode.value = 1;\r\n            this.close();\r\n            return;\r\n        }\r\n        this.createCoin();\r\n        this.createCoin();\r\n        this.createCoin();\r\n        this.createCoin();\r\n        this.createCoin();\r\n    }\r\n    clickBtnCBUp() {\r\n        this.clickBtn.scaleX = 1;\r\n        this.clickBtn.scaleY = 1;\r\n    }\r\n    clickBossBtnCB() {\r\n        GameLogic.Share.gotKillBossBounes = true;\r\n        let curG = WxApi.tempGrade;\r\n        let gGap = (curG - JJMgr.instance.dataConfig.front_box_gate) % JJMgr.instance.dataConfig.front_box_everygate == 0 &&\r\n            curG >= JJMgr.instance.dataConfig.front_box_gate;\r\n        if (!this.hadShowBanner && gGap && this.canShowBox && WxApi.isWhiteList && JJMgr.instance.dataConfig.is_allow_area == 1) {\r\n            this.hadShowBanner = true;\r\n            Laya.timer.once(500, this, () => {\r\n                AdMgr.instance.showAppBox();\r\n            });\r\n        }\r\n        this.curProgress += 0.15;\r\n        if (this.curProgress > 1) {\r\n            this.curProgress = 1;\r\n            this.barNode.value = 1;\r\n            this.close();\r\n            return;\r\n        }\r\n        this.createCoin();\r\n        this.createCoin();\r\n        this.createCoin();\r\n        this.createCoin();\r\n        this.createCoin();\r\n    }\r\n    closeBtnCB() {\r\n        this.close();\r\n    }\r\n    createCoin() {\r\n        let coin = PrefabManager.instance().getItem(PrefabItem.Coin);\r\n        this.addChild(coin);\r\n        coin.pos(375, 500);\r\n        let desPos = new Laya.Vector2(Math.random() * 400 - 200, Math.random() * 400 - 200);\r\n        Laya.Tween.to(coin, { x: desPos.x + 375, y: desPos.y + 500 }, 200);\r\n        Laya.timer.once(1000, this, () => {\r\n            coin.destroy();\r\n        });\r\n    }\r\n}\r\n",
  "references": [
    "E:/LayaProjects/DrawWeaponQQ/src/Mod/AdMgr.ts",
    "E:/LayaProjects/DrawWeaponQQ/src/Libs/PrefabManager.ts",
    "E:/LayaProjects/DrawWeaponQQ/src/Libs/WxApi.ts",
    "E:/LayaProjects/DrawWeaponQQ/src/JJExport/Common/JJMgr.ts",
    "E:/LayaProjects/DrawWeaponQQ/src/Libs/PlayerDataMgr.ts",
    "E:/LayaProjects/DrawWeaponQQ/src/Mod/Utility.ts",
    "E:/LayaProjects/DrawWeaponQQ/src/Crl/GameLogic.ts"
  ]
}
