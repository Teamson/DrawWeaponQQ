{
  "code": "import PlayerDataMgr from \"../Libs/PlayerDataMgr\";\r\nimport GameLogic from \"../Crl/GameLogic\";\r\nimport ShareMgr from \"../Mod/ShareMgr\";\r\nimport WxApi from \"../Libs/WxApi\";\r\nimport JJMgr from \"../JJExport/Common/JJMgr\";\r\nimport AdMgr from \"../Mod/AdMgr\";\r\nimport Utility from \"../Mod/Utility\";\r\nexport default class FinishUI extends Laya.Scene {\r\n    constructor() {\r\n        super();\r\n        this.openBoxBtn = this['openBoxBtn'];\r\n        this.videoBtn = this['videoBtn'];\r\n        this.noBtn = this['noBtn'];\r\n        this.bounes = this['bounes'];\r\n        this.moreGameBtn = this['moreGameBtn'];\r\n        this.boxBtnEnabled = true;\r\n    }\r\n    onOpened(param) {\r\n        AdMgr.instance.hideBanner();\r\n        WxApi.aldEvent('第' + PlayerDataMgr.getPlayerData().grade + '关：通关');\r\n        this.initData();\r\n    }\r\n    onClosed() {\r\n        AdMgr.instance.hideBanner();\r\n        Laya.timer.clearAll(this);\r\n    }\r\n    initData() {\r\n        this.openBoxBtn.on(Laya.Event.CLICK, this, this.openBoxCB);\r\n        this.videoBtn.on(Laya.Event.CLICK, this, this.videoBtnCB);\r\n        this.noBtn.on(Laya.Event.CLICK, this, this.noBtnCB);\r\n        this.moreGameBtn.on(Laya.Event.CLICK, this, this.moreGameBtnCB);\r\n        Utility.rotateLoop(this.moreGameBtn.getChildAt(0), 15, 100);\r\n        let grade = PlayerDataMgr.getPlayerData().grade - 1;\r\n        let g = Math.floor(grade % 4) == 0 ? 4 : Math.floor(grade % 4);\r\n        this.bounes.skin = g == 4 ? 'finishUI/js-bx.png' : 'finishUI/js-ys.png';\r\n        this.openBoxBtn.visible = g == 4;\r\n        this.videoBtn.visible = g != 4;\r\n        this.noBtn.visible = g != 4;\r\n        if (false) {\r\n            this['btnNode'].visible = false;\r\n            AdMgr.instance.showAppBox(() => {\r\n                this.closeAppCB();\r\n            });\r\n            Laya.timer.once(7000, this, this.closeAppCB);\r\n        }\r\n        else {\r\n            if (this.noBtn.visible)\r\n                WxApi.fixBtnTouchPos(this.noBtn, 320, 100, this);\r\n            else {\r\n                this.boxBtnEnabled = false;\r\n                WxApi.fixBtnTouchPos(this.openBoxBtn, 320, 0, this, () => { this.boxBtnEnabled = true; });\r\n            }\r\n        }\r\n        GameLogic.Share.isHelpStart = false;\r\n        GameLogic.Share.gradeIndex = 0;\r\n        PlayerDataMgr.getPlayerData().gradeIndex = 0;\r\n        PlayerDataMgr.setPlayerData();\r\n        this['bounesCoin'].visible = GameLogic.Share.gotKillBossBounes;\r\n        if (GameLogic.Share.gotKillBossBounes) {\r\n            GameLogic.Share.gotKillBossBounes = false;\r\n            let c = Utility.GetRandom(30, 100);\r\n            this['bounesCoin'].text = '成功领取' + c + '金币';\r\n            Utility.tMove2D(this['bounesCoin'], this['bounesCoin'].x, this['bounesCoin'].y - 100, 2000, () => { this['bounesCoin'].visible = false; });\r\n            PlayerDataMgr.changeCoin(c);\r\n        }\r\n    }\r\n    closeAppCB() {\r\n        let self = this;\r\n        AdMgr.instance.closeAppBox();\r\n        Laya.timer.clearAll(this);\r\n        self['btnNode'].visible = true;\r\n        if (self.noBtn.visible)\r\n            WxApi.fixBtnTouchPos(self.noBtn, 320, 100, self);\r\n        else {\r\n            self.boxBtnEnabled = false;\r\n            WxApi.fixBtnTouchPos(self.openBoxBtn, 320, 0, self, () => { self.boxBtnEnabled = true; });\r\n        }\r\n    }\r\n    moreGameBtnCB() {\r\n        AdMgr.instance.showAppBox();\r\n    }\r\n    openBoxCB() {\r\n        if (!this.boxBtnEnabled)\r\n            return;\r\n        Laya.Scene.open('MyScenes/BoxUI.scene');\r\n    }\r\n    videoBtnCB() {\r\n        WxApi.aldEvent('视频/分享打开宝箱：点击');\r\n        let cb = () => {\r\n            WxApi.aldEvent('视频/分享打开宝箱：成功');\r\n            Laya.Scene.open('MyScenes/BoxUI.scene');\r\n        };\r\n        ShareMgr.instance.shareGame(cb);\r\n    }\r\n    noBtnCB() {\r\n        this.close();\r\n        Laya.Scene.open('MyScenes/GameUI.scene', false, () => {\r\n            GameLogic.Share.restartGame();\r\n            if (JJMgr.instance.dataConfig.front_box_ads)\r\n                AdMgr.instance.showAppBox();\r\n        });\r\n    }\r\n}\r\n",
  "references": [
    "E:/LayaProjects/DrawWeaponQQ/src/Libs/PlayerDataMgr.ts",
    "E:/LayaProjects/DrawWeaponQQ/src/Crl/GameLogic.ts",
    "E:/LayaProjects/DrawWeaponQQ/src/Mod/ShareMgr.ts",
    "E:/LayaProjects/DrawWeaponQQ/src/Libs/WxApi.ts",
    "E:/LayaProjects/DrawWeaponQQ/src/JJExport/Common/JJMgr.ts",
    "E:/LayaProjects/DrawWeaponQQ/src/Mod/AdMgr.ts",
    "E:/LayaProjects/DrawWeaponQQ/src/Mod/Utility.ts"
  ]
}
