{
  "code": "import PlayerDataMgr from \"../Libs/PlayerDataMgr\";\r\nimport WxApi from \"../Libs/WxApi\";\r\nimport JJMgr from \"../JJExport/Common/JJMgr\";\r\nimport AdMgr from \"../Mod/AdMgr\";\r\nimport SoundMgr from \"../Mod/SoundMgr\";\r\nimport GameLogic from \"../Crl/GameLogic\";\r\nexport default class OpenPacketsUI extends Laya.Scene {\r\n    constructor() {\r\n        super();\r\n        this.openNode = this['openNode'];\r\n        this.txNode = this['txNode'];\r\n        this.closeOpenNodeBtn = this['closeOpenNodeBtn'];\r\n        this.openBtn = this['openBtn'];\r\n        this.tips = this['tips'];\r\n        this.cashNode = this['cashNode'];\r\n        this.coinNode = this['coinNode'];\r\n        this.closeTxBtn = this['closeTxBtn'];\r\n        this.cashNum = this['cashNum'];\r\n        this.getCashNum = this['getCashNum'];\r\n        this.tixianBtn = this['tixianBtn'];\r\n        this.coinNum = this['coinNum'];\r\n        this.getCoinBtn = this['getCoinBtn'];\r\n        this.isGetCash = true;\r\n        this.bounesNum = 0;\r\n    }\r\n    onOpened() {\r\n        AdMgr.instance.hideBanner();\r\n        AdMgr.instance.showBanner();\r\n        this.openBtn.on(Laya.Event.CLICK, this, this.openBtnCB);\r\n        this.closeOpenNodeBtn.on(Laya.Event.CLICK, this, this.closeCB);\r\n        this.closeTxBtn.on(Laya.Event.CLICK, this, this.closeCB);\r\n        this.tixianBtn.on(Laya.Event.CLICK, this, this.txBtnCB);\r\n        this.getCoinBtn.on(Laya.Event.CLICK, this, this.getCoinBtnCB);\r\n    }\r\n    onClosed() {\r\n        AdMgr.instance.hideBanner();\r\n        if (GameLogic.Share.gameStarted) {\r\n            AdMgr.instance.showBanner();\r\n        }\r\n    }\r\n    visibleOpenNode(vivible) {\r\n        this.openNode.visible = vivible;\r\n    }\r\n    visibleTXNode(vivible) {\r\n        this.txNode.visible = vivible;\r\n    }\r\n    openBtnCB() {\r\n        let cb = () => {\r\n            this.visibleOpenNode(false);\r\n            this.visibleTXNode(true);\r\n            let packetData = PlayerDataMgr.getPacketData();\r\n            let videoCount = packetData.videoCount;\r\n            console.log('packetData.curCash:', packetData.curCash);\r\n            if (parseFloat(packetData.curCash.toFixed(2)) >= 1.8) {\r\n                this.isGetCash = false;\r\n            }\r\n            else {\r\n                if (videoCount < 3) {\r\n                    this.isGetCash = true;\r\n                }\r\n                else {\r\n                    let cashPer = JJMgr.instance.dataConfig.front_luckymoney_probability;\r\n                    let randNum = Math.random() * 100;\r\n                    this.isGetCash = randNum < cashPer;\r\n                }\r\n            }\r\n            if (this.isGetCash) {\r\n                let b = 0;\r\n                if (videoCount == 0) {\r\n                    b = Math.random() * 0.1 + 0.4;\r\n                    b = parseFloat(b.toFixed(2));\r\n                }\r\n                else if (videoCount == 1) {\r\n                    b = Math.random() * 0.19 + 0.2;\r\n                    b = parseFloat(b.toFixed(2));\r\n                }\r\n                else if (videoCount == 2) {\r\n                    b = Math.random() * 0.19 + 0.2;\r\n                    b = parseFloat(b.toFixed(2));\r\n                }\r\n                else if (videoCount >= 3) {\r\n                    if (packetData.curCash >= 1.78) {\r\n                        b = 2 - packetData.curCash;\r\n                        b = parseFloat(b.toFixed(2));\r\n                    }\r\n                    else {\r\n                        b = Math.random() * 0.05 + 0.1;\r\n                        b = parseFloat(b.toFixed(2));\r\n                    }\r\n                }\r\n                this.bounesNum = b;\r\n                if (this.bounesNum + PlayerDataMgr.getPacketData().curCash > 1.8) {\r\n                    this.bounesNum = parseFloat((1.8 - PlayerDataMgr.getPacketData().curCash).toFixed(2));\r\n                }\r\n                this.gotCash();\r\n            }\r\n            else {\r\n                this.bounesNum = Math.floor(Math.random() * 200 + 100);\r\n                this.gotCoin();\r\n            }\r\n        };\r\n        AdMgr.instance.showVideo(cb);\r\n    }\r\n    gotCash() {\r\n        Laya.timer.once(500, this, () => {\r\n            SoundMgr.instance.playSoundEffect('money.mp3');\r\n        });\r\n        this.cashNode.visible = true;\r\n        this.coinNode.visible = false;\r\n        PlayerDataMgr.getPacketData().videoCount++;\r\n        PlayerDataMgr.getPacketData().curCash += parseFloat(this.bounesNum.toFixed(2));\r\n        PlayerDataMgr.setPacketData();\r\n        this.cashNum.text = PlayerDataMgr.getPacketData().curCash.toFixed(2) + '元';\r\n        this.getCashNum.text = this.bounesNum.toFixed(2) + '元';\r\n    }\r\n    gotCoin() {\r\n        Laya.timer.once(500, this, () => {\r\n            SoundMgr.instance.playSoundEffect('getCoin.mp3');\r\n        });\r\n        PlayerDataMgr.changeCoin(this.bounesNum);\r\n        this.cashNode.visible = false;\r\n        this.coinNode.visible = true;\r\n        this.coinNum.text = this.bounesNum.toString() + '金币';\r\n    }\r\n    txBtnCB() {\r\n        this.close();\r\n        Laya.Scene.open('MyScenes/TakeCashUI.scene', false);\r\n    }\r\n    getCoinBtnCB() {\r\n        WxApi.OpenAlert('恭喜获得金币');\r\n        this.closeCB();\r\n    }\r\n    closeCB() {\r\n        this.close();\r\n        WxApi.closePacketUICB && WxApi.closePacketUICB();\r\n        WxApi.closePacketUICB = null;\r\n    }\r\n}\r\n",
  "references": [
    "E:/LayaProjects/DrawWeaponQQ/src/Libs/PlayerDataMgr.ts",
    "E:/LayaProjects/DrawWeaponQQ/src/Libs/WxApi.ts",
    "E:/LayaProjects/DrawWeaponQQ/src/JJExport/Common/JJMgr.ts",
    "E:/LayaProjects/DrawWeaponQQ/src/Mod/AdMgr.ts",
    "E:/LayaProjects/DrawWeaponQQ/src/Mod/SoundMgr.ts",
    "E:/LayaProjects/DrawWeaponQQ/src/Crl/GameLogic.ts"
  ]
}
