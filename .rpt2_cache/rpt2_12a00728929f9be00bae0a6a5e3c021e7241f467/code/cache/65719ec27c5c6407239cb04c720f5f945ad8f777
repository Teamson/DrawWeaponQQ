{
  "code": "import WxApi from \"../Libs/WxApi\";\r\nimport ShareMgr from \"./ShareMgr\";\r\nimport JJMgr from \"../JJExport/Common/JJMgr\";\r\nexport default class AdMgr {\r\n    constructor() {\r\n        this.bannerUnitId = ['66e1008c167595adbc5450df9686edb8', 'cda95c4ef7ef0a6bfe3390e79c3f3069', '947d377267bea06eb446afe81328d792', '8a7c0bf18bb869abc182b7110fd70145'];\r\n        this.videoUnitId = '32351da471a086273478425fb7f99aab';\r\n        this.appBoxUnitId = 'e72c06906c7b12b06cfe70145816b8ed';\r\n        this.bannerAd = null;\r\n        this.videoAd = null;\r\n        this.blockAd = null;\r\n        this.videoCallback = null;\r\n        this.curBannerId = 0;\r\n        this.showBannerCount = 0;\r\n        this.isBannerError = false;\r\n        this.appBox = null;\r\n        this.videoIsError = false;\r\n        this.videoLoaded = false;\r\n        this.isCreateBAD = false;\r\n        this.appBoxCloseCB = null;\r\n    }\r\n    static get instance() {\r\n        if (!this._instance) {\r\n            this._instance = new AdMgr();\r\n        }\r\n        return this._instance;\r\n    }\r\n    initAd() {\r\n        if (Laya.Browser.onWeiXin) {\r\n            this.initBanner();\r\n            this.initVideo();\r\n            this.initAppBox();\r\n        }\r\n    }\r\n    initAppBox(isShow = false) {\r\n        if (Laya.Browser.onWeiXin) {\r\n            let self = this;\r\n            this.appBox = Laya.Browser.window.qq.createAppBox({\r\n                adUnitId: this.appBoxUnitId\r\n            });\r\n            this.appBox.load().then(() => {\r\n                if (isShow)\r\n                    this.appBox.show();\r\n            });\r\n            this.appBox.offClose();\r\n            this.appBox.onClose(() => {\r\n                if (self.appBoxCloseCB != null && self.appBoxCloseCB) {\r\n                    self.appBoxCloseCB();\r\n                }\r\n                self.closeAppBox();\r\n            });\r\n        }\r\n    }\r\n    showAppBox(cb) {\r\n        this.appBoxCloseCB = cb;\r\n        if (Laya.Browser.onWeiXin && this.appBox) {\r\n            this.appBox.show();\r\n        }\r\n        else if (Laya.Browser.onWeiXin && !this.appBox) {\r\n            this.initAppBox(true);\r\n        }\r\n    }\r\n    closeAppBox() {\r\n        if (Laya.Browser.onWeiXin && this.appBox) {\r\n            this.appBox.destroy();\r\n            this.appBox = null;\r\n            this.appBoxCloseCB = null;\r\n        }\r\n    }\r\n    initBanner(isShow) {\r\n        if (this.bannerAd != null) {\r\n            this.destroyBanner();\r\n        }\r\n        this.isBannerError = false;\r\n        let winSize = Laya.Browser.window.qq.getSystemInfoSync();\r\n        this.bannerAd = Laya.Browser.window.qq.createBannerAd({\r\n            adUnitId: this.bannerUnitId[this.curBannerId],\r\n            style: {\r\n                left: 0,\r\n                top: winSize.windowHeight - 100,\r\n                width: winSize.windowWidth\r\n            }\r\n        });\r\n        this.bannerAd.onResize(res => {\r\n            this.bannerAd.style.top = winSize.windowHeight - res.height;\r\n            this.bannerAd.style.left = winSize.windowWidth / 2 - res.width / 2;\r\n        });\r\n        this.bannerAd.onError(res => {\r\n            console.log('banner error:', JSON.stringify(res));\r\n            this.isBannerError = true;\r\n        });\r\n        if (isShow)\r\n            this.bannerAd.show();\r\n    }\r\n    hideBanner(isCount = true) {\r\n        if (Laya.Browser.onWeiXin) {\r\n            this.bannerAd.hide();\r\n            if (JJMgr.instance.dataConfig != null && this.showBannerCount >= parseInt(JJMgr.instance.dataConfig.front_banner_number)) {\r\n                this.showBannerCount = 0;\r\n                this.curBannerId++;\r\n                if (this.curBannerId >= this.bannerUnitId.length) {\r\n                    this.curBannerId = 0;\r\n                }\r\n                console.log('destroy banner');\r\n                this.destroyBanner();\r\n                this.initBanner();\r\n            }\r\n        }\r\n    }\r\n    showBanner() {\r\n        if (Laya.Browser.onWeiXin && this.bannerAd && !this.isBannerError) {\r\n            this.showBannerCount++;\r\n            this.bannerAd.show();\r\n            console.log('showBanner :', this.showBannerCount);\r\n        }\r\n        else if (Laya.Browser.onWeiXin && this.isBannerError) {\r\n            this.showBannerCount++;\r\n        }\r\n    }\r\n    destroyBanner() {\r\n        if (Laya.Browser.onWeiXin && this.bannerAd) {\r\n            this.bannerAd.destroy();\r\n            this.bannerAd = null;\r\n        }\r\n    }\r\n    initVideo() {\r\n        if (!Laya.Browser.onWeiXin) {\r\n            return;\r\n        }\r\n        if (!this.videoAd) {\r\n            this.videoAd = Laya.Browser.window.qq.createRewardedVideoAd({\r\n                adUnitId: this.videoUnitId\r\n            });\r\n        }\r\n        this.loadVideo();\r\n        this.videoAd.onLoad(() => {\r\n            console.log('激励视频加载成功');\r\n            this.videoLoaded = true;\r\n        });\r\n        this.videoAd.onError(res => {\r\n            console.log('video Error:', JSON.stringify(res));\r\n            this.videoIsError = true;\r\n        });\r\n    }\r\n    loadVideo() {\r\n        if (Laya.Browser.onWeiXin && this.videoAd != null) {\r\n            this.videoIsError = false;\r\n            this.videoAd.load();\r\n        }\r\n    }\r\n    showVideo(cb) {\r\n        this.videoCallback = cb;\r\n        if (!Laya.Browser.onWeiXin) {\r\n            this.videoCallback();\r\n            return;\r\n        }\r\n        if (this.videoIsError) {\r\n            ShareMgr.instance.shareGame(cb);\r\n            this.loadVideo();\r\n            return;\r\n        }\r\n        if (this.videoLoaded == false) {\r\n            WxApi.OpenAlert('视频正在加载中！');\r\n            return;\r\n        }\r\n        if (this.videoAd) {\r\n            this.videoAd.offClose();\r\n        }\r\n        Laya.SoundManager.muted = true;\r\n        this.videoAd.onClose((res) => {\r\n            if (res && res.isEnded || res === undefined) {\r\n                console.log('正常播放结束，可以下发游戏奖励');\r\n                this.videoCallback();\r\n            }\r\n            else {\r\n                console.log('播放中途退出，不下发游戏奖励');\r\n            }\r\n            Laya.SoundManager.muted = false;\r\n            AdMgr.instance.loadVideo();\r\n        });\r\n        this.videoAd.show();\r\n    }\r\n}\r\n",
  "references": [
    "E:/LayaProjects/DrawWeaponQQ/src/Mod/Utility.ts",
    "E:/LayaProjects/DrawWeaponQQ/src/Libs/WxApi.ts",
    "E:/LayaProjects/DrawWeaponQQ/src/Mod/ShareMgr.ts",
    "E:/LayaProjects/DrawWeaponQQ/src/JJExport/Common/JJMgr.ts",
    "E:/LayaProjects/DrawWeaponQQ/src/View/GameUI.ts"
  ]
}
